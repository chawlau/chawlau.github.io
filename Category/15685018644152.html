<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>  
	  
  	RabbitMQ和AMQP协议 -        凌云阁
  	
	</title>

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="atom.xml" rel="alternate" title="       凌云阁" type="application/atom+xml">

	<link href="asset/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="asset/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<script src="asset/javascripts/jquery.min.js"></script>
	<script src="asset/highlightjs/highlight.pack.js"></script>
	<link href="asset/highlightjs/styles/solarized_dark.css" media="screen, projection" rel="stylesheet" type="text/css">
<script>hljs.initHighlightingOnLoad();</script>

	<!--[if lt IE 9]><script src="asset/javascripts/html5.js"></script><![endif]-->
	<!-- <link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'> -->
	<style type="text/css">
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 300;
  src: local('Nunito-Light'), url(asset/font/1TiHc9yag0wq3lDO9cw0voX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 400;
  src: local('Nunito-Regular'), url(asset/font/6TbRXKWJjpj6V2v_WyRbMX-_kf6ByYO6CLYdB4HQE-Y.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 700;
  src: local('Nunito-Bold'), url(asset/font/TttUCfJ272GBgSKaOaD7KoX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
	</style>
	
	<style type="text/css">
	.container .left-col{ opacity: 1;}
	#pagenavi a{ font-size: 1.3em;}
	#pagenavi .next:before{ top: 3px;}
	#pagenavi .prev:before{ top: 3px;}
	.container .mid-col .mid-col-container #content .archives .title{ font-size: 1.5em;}
	.container .mid-col .mid-col-container #content article{ padding: 15px 0px;}
	#header .subtitle {
		line-height: 1.2em;
		padding-top: 8px;
	}
	article pre{ background: none; border: none; padding: 0;}
	article .entry-content{text-align: left;}
	.share-comment{ padding: 25px 0px; clear: both;}
	hr{ margin: 20px 0px;border: 0; border-top:solid 1px #ddd;}

	</style>
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner">
				 
				 	<div class="profilepic">
						<img src="https://i.loli.net/2020/02/22/Si1K7sluept2ZgR.jpg" style="width:160px;">
					</div>
            	
					
					<h1><a href="index.html">       凌云阁</a></h1>
					<p class="subtitle">生命的意义是成为你自己！</p>
					<nav id="main-nav">
						<ul class="main">
						
						  <li id=""><a target="_self" href="index.html">Home</a></li>
						
						  <li id=""><a target="_self" href="archives.html">Archives</a></li>
						
						</ul>
					</nav>

					<nav id="sub-nav">
						<div class="social">

<a target="_blank" class="facebook" href="www.facebook.com" title="Facebook">Facebook</a>






<a target="_blank" class="weibo" href="www.weibo.com" title="weibo">Weibo</a>
<a target="_blank" class="twitter" target="_blank" href="www.twitter.com" title="Twitter">Twitter</a>
<a target="_blank" class="github" target="_blank" href="www.github.com/chawlau" title="GitHub">GitHub</a>


								

								<a class="rss" href="atom.xml" title="RSS">RSS</a>
							
						</div>
					</nav>
				</header>				
			</div>
		</div>	
		<div class="mid-col">
			<div class="mid-col-container"> <div id="content" class="inner">

	<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
		<h1 class="title" itemprop="name">RabbitMQ和AMQP协议</h1>
		<div class="entry-content" itemprop="articleBody">
			<ul>
<li>导航<br />
<img src="media/15685018644152/15685019251376.jpg" alt="" style="width:788px;" /><br />
<img src="media/15685018644152/15685019353551.jpg" alt="" style="width:864px;" /><br />
<img src="media/15685018644152/15685019742034.jpg" alt="" style="width:912px;" /></li>
</ul>
<h4><a id="%E5%88%9D%E5%A7%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>初始</h4>
<ul>
<li>优点</li>
<li>集群模式丰富，表达式配置，HA 模式，镜像队列模型 √保证数据不丟失的前提做到高可靠性、可用性</li>
</ul>
<h4><a id="%E9%AB%98%E6%80%A7%E8%83%BD%E5%8E%9F%E5%9B%A0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>高性能原因</h4>
<ul>
<li>Erlang 语言最初在于交换机领域的架构模式，这样使得 Rabbitmq 在 Broker 之间进行数据交互的性能是非常优秀的</li>
<li>Erlang 的优点：Erlang 有着和原生 Socket-样的延迟</li>
</ul>
<h4><a id="amqp" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>AMQP</h4>
<ul>
<li><img src="media/15685018644152/15685025982263.jpg" alt="" style="width:1087px;" /></li>
<li>Server：又称 Broker，接受客户端的连接，实现 AMQP 实体服务</li>
<li>Connection：连接，应用程序与 Broker 的网络连接</li>
<li>Channel：网络信道，几乎所有的操作都在 Channels 中进行，Channel 是进行消息读写的通道。客户端可建立多个 hannel，每个 Channel 代表一个会话任务。</li>
<li>Message：消息、服务器和应用程序之间传送的数据，由 Properties 和 Body 组成。Properties 可以对消息进行修饰，比如消息的优先级延迟等高级特性；Body 则就是消息体内容。</li>
<li>Virtual host：虚拟地址，用于进行逻辑隔离，最上层的消息路由。一个Virtual Host里面可以有若干个Exchange和Queue，同一个 Virtual Host 里面不能有相同名称的 Exchange 或 Queue</li>
<li>Exchange 交换机，接收消息，根据路由键转发消息到绑定的队列</li>
<li>Binding: Exchange 和 Queue 之间的虚拟连接，binding 中可以包含 routing key</li>
<li>Routing Key 路由规则，虚拟机可用它来确定如何路由一个特定消息</li>
<li>Queue：也称为 Message Queue，消息队列，保存消息并将它们转发给消费者</li>
</ul>
<h4><a id="%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>整体架构</h4>
<ul>
<li><img src="media/15685018644152/2018-12-12%2017-01-57%20%E7%9A%84%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2018-12-12 17-01-57 的屏幕截图" /></li>
<li><img src="media/15685018644152/15685032427468.jpg" alt="" style="width:1095px;" /></li>
<li><img src="media/15685018644152/15685033008191.jpg" alt="" style="width:1125px;" /></li>
<li>生产者无需关系消息投递到哪个队列，消费者无须知道消息从哪个exchange来</li>
<li></li>
</ul>
<h4><a id="%E5%AE%89%E8%A3%85rabbitmq" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>安装rabbitmq</h4>
<ul>
<li><img src="media/15685018644152/15685094890042.jpg" alt="" style="width:477px;" /></li>
</ul>
<h4><a id="%E5%91%BD%E4%BB%A4%E8%A1%8C" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>命令行</h4>
<ul>
<li><img src="media/15685018644152/15685919640494.jpg" alt="" style="width:1284px;" /></li>
<li>rabbitmqctl list user permissions username：列出用户权限</li>
<li>rabbitmqctl change_ password username newpassword：修改密码</li>
<li>rabbitmqctl set permissions-p vhostpath username &quot;.<em>&quot; &quot;.</em>&quot; &quot;.*&quot; 设置用户权限</li>
<li>Rabbitmqctl add vhost vhostpath：创建虚拟主机</li>
<li>rabbitmgctl list vhosts：列出所有虚拟主机</li>
<li>rabbitmqctl list permissions- o vhostpath：列出虚拟主机上所有权限</li>
<li>rabbitmqctl delete_ vhost vhostpath：删除虚拟主机</li>
<li>rabbitmqctl reset</li>
<li>Rabbitmactl join cluster <clusternode> [--ram][--disc]：组成集群命令</li>
<li>rabbitmqctl cluster_status</li>
<li>rabbitmactl change cluster node type disc ram</li>
<li>rabbitmactl forget cluster node [-offline] 忘记节点（摘除节点)</li>
<li></li>
</ul>
<h4><a id="import-export" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>import&amp;export</h4>
<ul>
<li>批量导出配置文件</li>
</ul>
<h4><a id="%E7%94%9F%E4%BA%A7%E8%80%85%E5%92%8C%E6%B6%88%E8%B4%B9%E8%80%85" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>生产者和消费者</h4>
<ul>
<li>消费端一定要创建consumer,声明消费队列</li>
<li>没有指定exchange,就会使用默认的路由规则</li>
</ul>
<h4><a id="exchange%E4%BA%A4%E6%8D%A2%E6%9C%BA" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exchange交换机</h4>
<ul>
<li><img src="media/15685018644152/15686780874004.jpg" alt="" style="width:1196px;" /></li>
<li>蓝色表示SendMessage</li>
<li>绿色表示RecvMessage</li>
<li>黄色表示routing-key</li>
</ul>
<h5><a id="%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%B1%9E%E6%80%A7" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>交换机属性</h5>
<ul>
<li>Name：交换机名称</li>
<li>Type：交换机类型 direct、topic、fanout、headers</li>
<li>Durability 是否需要持久化，true 为持久</li>
<li>Auto Delete：当最后一个绑定到 Exchange 上的队列删除后，自动删除该 Exchange</li>
<li>Internal：当前 Exchange 是否用于 Rabbit MQP 内部使用，默认为 False</li>
<li>Arguments：扩展参数，用于扩展 AMQP 协议自制定化使用</li>
</ul>
<h5><a id="direct-exchange" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Direct Exchange</h5>
<ul>
<li>所有发送到 Direct Exchange 的消息被转发到 Routekey 中指定的 Queue</li>
<li>注意：Directa 模式可以使用 Rabbitmq 自带的 Exchange: default Exchange，所以不需要将 Exchange 进行任何绑定（binding）操作，消息传递时，Routekey 必须完全匹配才会被队列接收，否则该消息会被抛弃</li>
<li><img src="media/15685018644152/15686783728891.jpg" alt="" style="width:1301px;" /></li>
<li><img src="media/15685018644152/15713502113780.jpg" alt="" style="width:1426px;" /></li>
</ul>
<h5><a id="topic-exchange" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Topic Exchange</h5>
<ul>
<li>所有发送到 Topic Exchangee 的消息被转发到所有关心 Route Keyi 中指定 Topic 的 Queue 上</li>
<li>Exchange 将 Routekey 和某 Topic 进行模糊匹配，此时队列需要绑定一个 Topic</li>
<li><img src="media/15685018644152/15687601895357.jpg" alt="" style="width:984px;" /></li>
<li><img src="media/15685018644152/15687602026259.jpg" alt="" style="width:1131px;" /></li>
</ul>
<h4><a id="fanout-exchange" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Fanout Exchange</h4>
<ul>
<li>不处理路由键，只需要简单的将队列绑定到交换机上</li>
<li>发送到交换机的消息都会被转发到与该交换机绑定的所有队列上</li>
<li>Fanout 交换机转发消息是最快的</li>
<li><img src="media/15685018644152/15687618674083.jpg" alt="" style="width:1081px;" /></li>
</ul>
<h4><a id="binding" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Binding</h4>
<ul>
<li>Exchange？和 Exchange、Queue 之间的连接关系</li>
<li>Binding 中可以包含 Routing keyi 或者参数</li>
</ul>
<h4><a id="queue" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Queue</h4>
<ul>
<li>消息队列，实际存储消息数据</li>
<li>Durability：是否持久化，Durable：是，Transient：否</li>
<li>Auto delete：如选 yes，代表当最后一个监听被移除之后</li>
<li>该 Queue 会自动被删除</li>
</ul>
<h4><a id="message" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Message</h4>
<ul>
<li>服务器和应用程序之间传送的数据</li>
<li>本质上就是一段数据，由 Properties 和 Payload (Body）组成</li>
<li>常用属性：delivery mode、headers（自定义属性</li>
<li>Content type、content encoding、priority correlation id、reply to、expiration、message_id timestamp、type、user-id、app_id、cluster id</li>
<li>correlation_id比较重要</li>
</ul>
<h4><a id="virtual-host" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Virtual host</h4>
<ul>
<li>虚拟地址，用于进行逻辑隔离，最上层的消息路由</li>
<li>一个 Virtual Host 里面可以有若干个 Exchange 和 Queue</li>
<li>同一个 Virtual Host 里面不能有相同名称的 Exchange 或 Queue</li>
</ul>

		</div>
	</article>
	<div class="share-comment">
	 

	  

	  

	</div>
</div>        </div>
			<footer id="footer" class="inner">Copyright &copy; 2014
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; 
Theme by <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>
      </footer>
		</div>
	</div>

  
    



</body>
</html>