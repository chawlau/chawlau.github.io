<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>  
	  
  	中介模式 -        凌云阁
  	
	</title>

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="atom.xml" rel="alternate" title="       凌云阁" type="application/atom+xml">

	<link href="asset/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="asset/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<script src="asset/javascripts/jquery.min.js"></script>
	<script src="asset/highlightjs/highlight.pack.js"></script>
	<link href="asset/highlightjs/styles/solarized_dark.css" media="screen, projection" rel="stylesheet" type="text/css">
<script>hljs.initHighlightingOnLoad();</script>

	<!--[if lt IE 9]><script src="asset/javascripts/html5.js"></script><![endif]-->
	<!-- <link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'> -->
	<style type="text/css">
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 300;
  src: local('Nunito-Light'), url(asset/font/1TiHc9yag0wq3lDO9cw0voX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 400;
  src: local('Nunito-Regular'), url(asset/font/6TbRXKWJjpj6V2v_WyRbMX-_kf6ByYO6CLYdB4HQE-Y.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 700;
  src: local('Nunito-Bold'), url(asset/font/TttUCfJ272GBgSKaOaD7KoX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
	</style>
	
	<style type="text/css">
	.container .left-col{ opacity: 1;}
	#pagenavi a{ font-size: 1.3em;}
	#pagenavi .next:before{ top: 3px;}
	#pagenavi .prev:before{ top: 3px;}
	.container .mid-col .mid-col-container #content .archives .title{ font-size: 1.5em;}
	.container .mid-col .mid-col-container #content article{ padding: 15px 0px;}
	#header .subtitle {
		line-height: 1.2em;
		padding-top: 8px;
	}
	article pre{ background: none; border: none; padding: 0;}
	article .entry-content{text-align: left;}
	.share-comment{ padding: 25px 0px; clear: both;}
	hr{ margin: 20px 0px;border: 0; border-top:solid 1px #ddd;}

	</style>
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner">
				 
				 	<div class="profilepic">
						<img src="https://i.loli.net/2020/02/22/Si1K7sluept2ZgR.jpg" style="width:160px;">
					</div>
            	
					
					<h1><a href="index.html">       凌云阁</a></h1>
					<p class="subtitle">生命的意义是成为你自己！</p>
					<nav id="main-nav">
						<ul class="main">
						
						  <li id=""><a target="_self" href="index.html">Home</a></li>
						
						  <li id=""><a target="_self" href="archives.html">Archives</a></li>
						
						</ul>
					</nav>

					<nav id="sub-nav">
						<div class="social">

<a target="_blank" class="facebook" href="www.facebook.com" title="Facebook">Facebook</a>






<a target="_blank" class="weibo" href="www.weibo.com" title="weibo">Weibo</a>
<a target="_blank" class="twitter" target="_blank" href="www.twitter.com" title="Twitter">Twitter</a>
<a target="_blank" class="github" target="_blank" href="www.github.com/chawlau" title="GitHub">GitHub</a>


								

								<a class="rss" href="atom.xml" title="RSS">RSS</a>
							
						</div>
					</nav>
				</header>				
			</div>
		</div>	
		<div class="mid-col">
			<div class="mid-col-container"> <div id="content" class="inner">

	<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
		<h1 class="title" itemprop="name">中介模式</h1>
		<div class="entry-content" itemprop="articleBody">
			<h4><a id="%E5%8A%A8%E6%9C%BA" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>动机</h4>
<ul>
<li>在软件构建过程中，经常会出现多个对象互相关联交互的情况，对象之间常常会维持一种复杂的引用关系，如果遇到一些需求的更改，这种直接的引用关系将面临不断的变化。</li>
<li>在这种情況下，我们可使用一个“中介对象”来管理对象间的关联关系，避免相互交互的对象之间的紧耦合引用关系，从而更好地抵御变化。</li>
</ul>
<h4><a id="%E6%A8%A1%E5%BC%8F%E5%AE%9A%E4%B9%89" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>模式定义</h4>
<ul>
<li>用一个中介对象来封装（封装变化）一系列的对象交互。中介者使各对象不需要显式的相互引用（编译时依赖运行时依赖），从而使其耦合松散（管理变化），而且可以独立地改变它们之间的交互</li>
<li>编译时依赖改成运行时依赖</li>
</ul>
<h4><a id="%E7%BB%93%E6%9E%84" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>结构</h4>
<p><img src="media/15742917885791/15803924036000.jpg" alt="" style="width:758px;" /></p>
<p><img src="media/15742917885791/15742924128916.jpg" alt="" style="width:986px;" /></p>
<h4><a id="%E8%A6%81%E7%82%B9%E6%80%BB%E7%BB%93" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>要点总结</h4>
<ul>
<li>
<p>将多个对象间复杂的关联关系解耦，Mediator 模式将多个对象间的控制逻辑进行集中管理，变“多个对象互相关联“为“多个对象和一个中介者关联“，简化了系统的维护，抵御了可能的变化。</p>
</li>
<li>
<p>随着控制逻辑的复杂化，Mediator 具体对象的实现可能相当复杂。这时候可以对 Mediator 对象进行分解处理。</p>
</li>
<li>
<p>Facade 模式是解耦系统（单向）的对象关联关系；Mediator 模式是解耦系统内各个对象之间（双向）的关联关系。</p>
</li>
</ul>
<h4><a id="golang-demo" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>golang_demo</h4>
<pre><code class="language-go">package desian_pattern_practise

import (
	&quot;reflect&quot;
	&quot;strings&quot;
	&quot;sync&quot;
)

var (
	mediator *Mediator
	monce sync.Once
)
type IColleague interface {
	GetMediator()
}

type Colleague struct {
	mediator IMediator
}


type IMediator interface {
	Execute(IColleague)
}

type Mediator struct {
	cd, cpu, videoCard, soundCard IColleague
}

func (m *Mediator) SetCD(cd IColleague) {
	m.cd = cd
}

func (m *Mediator) SetCpu(cpu IColleague) {
	m.cpu = cpu
}

func (m *Mediator) SetVideoCard(videoCard IColleague) {
	m.videoCard = videoCard
}

func (m *Mediator) SetSoundCard(soundCard IColleague) {
	m.soundCard = soundCard
}

func GetMediator() *Mediator {
	monce.Do(func() {
		mediator = &amp;Mediator{}
	})
	return mediator
}

func (m *Mediator) Execute(i IColleague) {
	switch i.(type) {
	case *CDDriver:
		m.cpu.(*Cpu).Process(i.(*CDDriver).data)
	case *Cpu:
		m.soundCard.(*SoundCard).Play(i.(*Cpu).audio)
		m.videoCard.(*VideoCard).Display(i.(*Cpu).video)
	}
}

type CDDriver struct {
	*Colleague
	data string
}

func NewCDDriver() *CDDriver {
	return &amp;CDDriver{
		Colleague: &amp;Colleague{
			mediator: GetMediator(),
		},
	}
}

func (c *CDDriver) GetMediator() {}

func (c *CDDriver) ReadData() {
	c.data = &quot;music, image&quot;
	println(reflect.TypeOf(c).String() + &quot; reading data&quot;)
	c.mediator.Execute(c)
}

type Cpu struct {
	*Colleague
	video, audio string
}

func NewCpu() *Cpu{
	return &amp;Cpu {
		Colleague: &amp;Colleague{
			mediator: GetMediator(),
		},
	}
}

func (c *Cpu) GetMediator() {}

func (c *Cpu) Process(data string) {
	sp := strings.Split(data, &quot;,&quot;)
	c.video = sp[1]
	c.audio = sp[0]
	println(reflect.TypeOf(c).String() + &quot; video &quot; + c.video + &quot; audio &quot;, c.audio)
	c.mediator.Execute(c)
}

type VideoCard struct {
	*Colleague
}

func NewVideoCard() *VideoCard{
	return &amp;VideoCard {
		Colleague: &amp;Colleague{
			mediator: GetMediator(),
		},
	}
}

func (v *VideoCard) GetMediator() {}

func (v *VideoCard) Display(data string) {
	println(reflect.TypeOf(v).String() + &quot; display data &quot;, data)
	v.mediator.Execute(v)
}

type SoundCard struct {
	*Colleague
}

func NewSoundCard() *SoundCard {
	return &amp;SoundCard {
		Colleague: &amp;Colleague{
			mediator: GetMediator(),
		},
	}
}

func (v *SoundCard) GetMediator() {}

func (v *SoundCard) Play(data string) {
	println(reflect.TypeOf(v).String() + &quot; play data &quot;, data)
	v.mediator.Execute(v)
}

package desian_pattern_practise

import &quot;testing&quot;

func TestMediator_Execute(t *testing.T) {
	cd:= NewCDDriver()
	cpu := NewCpu()
	soundCard := NewSoundCard()
	videoCard := NewVideoCard()
	GetMediator().SetCD(cd)
	GetMediator().SetCpu(cpu)
	GetMediator().SetSoundCard(soundCard)
	GetMediator().SetVideoCard(videoCard)
	cd.ReadData()
}
</code></pre>
<h4><a id="cpp-demo" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>cpp_demo</h4>
<pre><code class="language-C++">//
// Created by eredinliu on 2020-01-31.
//
#include &lt;iostream&gt;
#include &lt;mutex&gt;
#include &lt;typeinfo&gt;
#include &lt;boost/algorithm/string.hpp&gt;
#include &lt;vector&gt;

using namespace std;
using namespace boost;

class Mediator;
class Colleague {
public:
    Colleague(Mediator* _mediator) : mediator(_mediator) {}

protected:
    Mediator* mediator;
};

class Cpu;
class CDDriver;
class VideoCard;
class SoundCard;

class Mediator {
public:
    static Mediator* mediator;

    static Mediator* GetMediator() {
        static once_flag flag;
        call_once(flag, [&amp;](){mediator = new Mediator();});
        return mediator;
    }

    void SetCD(CDDriver* cd) {this-&gt;cd = cd;}

    void SetCpu(Cpu* cpu) {this-&gt;cpu = cpu;}

    void SetVideoCard(VideoCard* video) {this-&gt;videoCard = video;}

    void SetSoundCard(SoundCard* sound) {this-&gt;soundCard = sound;}

    void Execute(Colleague* colleague);
private:
    CDDriver* cd;
    Cpu* cpu;
    VideoCard *videoCard;
    SoundCard *soundCard;
    Mediator() {}
};

Mediator* Mediator::mediator = nullptr;

class CDDriver : public Colleague {
public:
    CDDriver(Mediator* _mediator) : Colleague(_mediator) {}

    void ReadData() {
        this-&gt;data = &quot;Music,Image&quot;;
        cout &lt;&lt; typeid(this).name() &lt;&lt; &quot; reading data&quot; &lt;&lt; endl;
        this-&gt;mediator-&gt;Execute(this);
    }

    string&amp; GetData() {
        return this-&gt;data;
    }
private:
    string data;
};

class Cpu : public Colleague {
public:
    friend class Mediator;
    Cpu(Mediator* _mediator) : Colleague(_mediator) {}

    void Process(string&amp; data) {
        vector&lt;string&gt; str_vec;
        split(str_vec, data, is_any_of(&quot;,&quot;));
        this-&gt;video = str_vec[1];
        this-&gt;sound = str_vec[0];
        cout &lt;&lt; typeid(this).name() &lt;&lt; &quot; video &quot; &lt;&lt; this-&gt;video &lt;&lt; &quot; sound &quot;
        &lt;&lt; this-&gt;sound &lt;&lt; endl;
        this-&gt;mediator-&gt;Execute(this);
    }

    string&amp; GetVideo() {return this-&gt;video;}

    string&amp; GetSound() {return this-&gt;sound;}
private:
    string video, sound;
};

class VideoCard : public Colleague {
public:
    VideoCard(Mediator* _mediator) : Colleague(_mediator) {}

    void Process(string&amp; data) {
        cout &lt;&lt; typeid(this).name() &lt;&lt; &quot; display &quot; &lt;&lt; data &lt;&lt; endl;
        this-&gt;mediator-&gt;Execute(this);
    }
};

class SoundCard : public Colleague {
public:
    SoundCard(Mediator* _mediator) : Colleague(_mediator) {}

    void Process(string&amp; data) {
        cout &lt;&lt; typeid(this).name() &lt;&lt; &quot; play &quot; &lt;&lt; data &lt;&lt; endl;
        this-&gt;mediator-&gt;Execute(this);
    }
};

void Mediator::Execute(Colleague* colleague) {
    if (colleague == cd) {
        cpu-&gt;Process(cd-&gt;GetData());
    } else if (colleague == cpu){
        soundCard-&gt;Process(cpu-&gt;GetSound());
        videoCard-&gt;Process(cpu-&gt;GetVideo());
    }
}

int main() {
    Mediator* mediator = Mediator::GetMediator();
    CDDriver* cd = new CDDriver(mediator);
    Cpu* cpu = new Cpu(mediator);
    SoundCard* soundCard = new SoundCard(mediator);
    VideoCard* videoCard = new VideoCard(mediator);
    mediator-&gt;SetCD(cd);
    mediator-&gt;SetCpu(cpu);
    mediator-&gt;SetSoundCard(soundCard);
    mediator-&gt;SetVideoCard(videoCard);
    cd-&gt;ReadData();
}
</code></pre>
<h4><a id="python-code" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>python_code</h4>
<pre><code class="language-python">from abc import ABCMeta, abstractmethod

class Colleague(object):

    def __init__(self, mediator):
        self.mediator = mediator


def singleton(cls, *args, **kwargs):
    instance = {}

    def __singleton(*args, **kwargs):
        if cls not in instance:
            instance[cls] = cls(*args, **kwargs)
        return instance[cls]

    return __singleton

@singleton
class Mediator(object):

    def __init__(self):
        self.__cd = self.__cpu = self.__video_card = self.__sound_card = None

    def set_cd(self, cd):
        self.__cd  = cd

    def set_cpu(self, cpu):
        self.__cpu = cpu

    def set_video_card(self, video_card):
        self.__video_card = video_card

    def set_sound_card(self, sound_card):
        self.__sound_card = sound_card

    def execute(self, colleague):
        if colleague == self.__cd:
            self.__cpu.process(self.__cd.get_data())
        elif colleague == self.__cpu:
            self.__sound_card.process(colleague.get_sound())
            self.__video_card.process(colleague.get_video())

class CDDriver(Colleague):

    def __init__(self, mediator):
        super().__init__(mediator)
        self.__data = ''

    def read_data(self):
        self.__data = 'Music,Image'
        print(type(self).__name__, &quot; reading data&quot;)
        self.mediator.execute(self)

    def get_data(self):
        return self.__data

class Cpu(Colleague):

    def __init__(self, mediator):
        super().__init__(mediator)
        self.__video = self.__sound = ''

    def process(self, data):
        ret = data.split(',')
        self.__video = ret[1]
        self.__sound = ret[0]
        print(type(self).__name__, &quot; video {} sound {}&quot;.format(self.__video, 
                                                               self.__sound))

        self.mediator.execute(self)

    def get_video(self):
        return self.__video

    def get_sound(self):
        return self.__sound


class VideoCard(Colleague):

    def __init__(self, mediator):
        super().__init__(mediator)

    def process(self, data):
        print(type(self).__name__, &quot; display {}&quot;.format(data))


class SoundCard(Colleague):

    def __init__(self, mediator):
        super().__init__(mediator)

    def process(self, data):
        print(type(self).__name__, &quot; play {}&quot;.format(data))

if __name__ == '__main__':
    mediator = Mediator()
    cd = CDDriver(mediator)
    cpu = Cpu(mediator)
    sound_card = SoundCard(mediator)
    video_card = VideoCard(mediator)
    mediator.set_cd(cd)
    mediator.set_cpu(cpu)
    mediator.set_sound_card(sound_card)
    mediator.set_video_card(video_card)
    cd.read_data()
</code></pre>

		</div>
	</article>
	<div class="share-comment">
	 

	  

	  

	</div>
</div>        </div>
			<footer id="footer" class="inner">Copyright &copy; 2014
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; 
Theme by <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>
      </footer>
		</div>
	</div>

  
    



</body>
</html>