<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>  
	  
  	linux服务器研发 -        凌云阁
  	
	</title>

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="atom.xml" rel="alternate" title="       凌云阁" type="application/atom+xml">

	<link href="asset/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="asset/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<script src="asset/javascripts/jquery.min.js"></script>
	<script src="asset/highlightjs/highlight.pack.js"></script>
	<link href="asset/highlightjs/styles/solarized_dark.css" media="screen, projection" rel="stylesheet" type="text/css">
<script>hljs.initHighlightingOnLoad();</script>

	<!--[if lt IE 9]><script src="asset/javascripts/html5.js"></script><![endif]-->
	<!-- <link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'> -->
	<style type="text/css">
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 300;
  src: local('Nunito-Light'), url(asset/font/1TiHc9yag0wq3lDO9cw0voX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 400;
  src: local('Nunito-Regular'), url(asset/font/6TbRXKWJjpj6V2v_WyRbMX-_kf6ByYO6CLYdB4HQE-Y.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
/* latin */
@font-face {
  font-family: 'Nunito';
  font-style: normal;
  font-weight: 700;
  src: local('Nunito-Bold'), url(asset/font/TttUCfJ272GBgSKaOaD7KoX0hVgzZQUfRDuZrPvH3D8.woff2) format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2212, U+2215, U+E0FF, U+EFFD, U+F000;
}
	</style>
	
	<style type="text/css">
	.container .left-col{ opacity: 1;}
	#pagenavi a{ font-size: 1.3em;}
	#pagenavi .next:before{ top: 3px;}
	#pagenavi .prev:before{ top: 3px;}
	.container .mid-col .mid-col-container #content .archives .title{ font-size: 1.5em;}
	.container .mid-col .mid-col-container #content article{ padding: 15px 0px;}
	#header .subtitle {
		line-height: 1.2em;
		padding-top: 8px;
	}
	article pre{ background: none; border: none; padding: 0;}
	article .entry-content{text-align: left;}
	.share-comment{ padding: 25px 0px; clear: both;}
	hr{ margin: 20px 0px;border: 0; border-top:solid 1px #ddd;}

	</style>
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
				<header id="header" class="inner">
				 
				 	<div class="profilepic">
						<img src="https://i.loli.net/2020/02/22/Si1K7sluept2ZgR.jpg" style="width:160px;">
					</div>
            	
					
					<h1><a href="index.html">       凌云阁</a></h1>
					<p class="subtitle">生命的意义是成为你自己！</p>
					<nav id="main-nav">
						<ul class="main">
						
						  <li id=""><a target="_self" href="index.html">Home</a></li>
						
						  <li id=""><a target="_self" href="archives.html">Archives</a></li>
						
						</ul>
					</nav>

					<nav id="sub-nav">
						<div class="social">

<a target="_blank" class="facebook" href="www.facebook.com" title="Facebook">Facebook</a>






<a target="_blank" class="weibo" href="www.weibo.com" title="weibo">Weibo</a>
<a target="_blank" class="twitter" target="_blank" href="www.twitter.com" title="Twitter">Twitter</a>
<a target="_blank" class="github" target="_blank" href="www.github.com/chawlau" title="GitHub">GitHub</a>


								

								<a class="rss" href="atom.xml" title="RSS">RSS</a>
							
						</div>
					</nav>
				</header>				
			</div>
		</div>	
		<div class="mid-col">
			<div class="mid-col-container"> <div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2019-08-28T17:42:37+08:00" itemprop="datePublished">2019/08/28 17:42 下午</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A0%94%E5%8F%91.html'>linux服务器研发</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="15669853573173.html" itemprop="url">
		Mysql</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h4><a id="%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E5%92%8C%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>读写分离和分库分表</h4>
<ul>
<li>高可用 主主同步</li>
<li>高并发 读写分离和分库分表</li>
<li>自动扩容 部署机器好扩展</li>
<li>myisam 叶子节点保存的是指针和offset</li>
<li>innodb 数据保存在磁盘块中</li>
</ul>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2019-08-01T17:38:52+08:00" itemprop="datePublished">2019/08/01 17:38 下午</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A0%94%E5%8F%91.html'>linux服务器研发</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="15646523320655.html" itemprop="url">
		zmq为什么高效</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h4><a id="%E6%80%A7%E8%83%BD" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>性能</h4>
<ul>
<li>RTT</li>
<li>TPS</li>
<li>关闭Nagle算法，关闭网卡中断汇聚在一个cpu，提高IO吞吐能力上，开启网络接口的多队列功能，这样，每个队列就可以用不同的中断号，调度到不同 CPU 上执行</li>
<li>区别大小消息，零拷贝 92字节为临界点</li>
<li>批量发送和接收消息</li>
<li>非同步零数据CPU迁移的并发编程 通过管道</li>
<li>无锁算法</li>
</ul>
<h4><a id="%E7%BA%BF%E7%A8%8B%E9%97%B4%E5%85%B1%E4%BA%AB%E6%95%B0%E6%8D%AE" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>线程间共享数据</h4>
<ul>
<li>send(cmd)</li>
<li>socket</li>
<li>socketpair</li>
<li>信号 pipe</li>
<li>eventfd</li>
</ul>
<h5><a id="%E6%9E%B6%E6%9E%84" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>架构</h5>
<ul>
<li><img src="media/15646523320655/15646568568348.jpg" alt="" /></li>
<li>engine负责对底层事件发送和接收解码和内核打交道，依赖poller</li>
<li>poller 对epoll进行封装</li>
<li>pipes inbound 和 outbound 读写两个管道</li>
<li>mailbox就是对pipe的封装，两个线程之间发送数据</li>
<li>session 管理每个连接，管理客户端连接</li>
<li>session和engine绑定到每个io thread</li>
<li>zmq_socket可以对应多个客户端，通过算法将session和engine绑定到io_thread</li>
<li>poller监听到数据会把socketfd发给listener处理，listener会创建engine和session</li>
<li>读事件发生poller-&gt;engine-&gt;内核拷贝数据-&gt;session-&gt;inbound-&gt;api接口读取数据</li>
<li>写事件是engine从session中读取消息</li>
</ul>
<h4><a id="%E6%B6%88%E6%81%AF%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>消息内存管理</h4>
<ul>
<li>短消息vsm直接初始化在栈上</li>
<li>zmq_msg_t-&gt;msg_t</li>
<li>move 就是删除引用计数</li>
<li></li>
</ul>
<pre><code class="language-plain_text">   union {
    struct {
      metadata_t *metadata;
      unsigned char unused [msg_t_size - (8 + sizeof (metadata_t *) + 2)];
      unsigned char type;
      unsigned char flags;
    } base;
    struct {
      metadata_t *metadata;
      unsigned char data [max_vsm_size];
      unsigned char size;
      unsigned char type;
      unsigned char flags;
    } vsm;
    struct {
      metadata_t *metadata;
      content_t *content;
      unsigned char unused [msg_t_size - (8 + sizeof (metadata_t *) + sizeof (content_t*) + 2)];
      unsigned char type;
      unsigned char flags;
    } lmsg;
    struct {
      metadata_t *metadata;
      void* data;
      size_t size;
      unsigned char unused
          [msg_t_size - (8 + sizeof (metadata_t *) + sizeof (void*) + sizeof (size_t) + 2)];
      unsigned char type;
      unsigned char flags;
    } cmsg;
    struct {
      metadata_t *metadata;
      unsigned char unused [msg_t_size - (8 + sizeof (metadata_t *) + 2)];
      unsigned char type;
      unsigned char flags;
    } delimiter;
  } u;
</code></pre>
<p><img src="media/15646523320655/15646582517066.jpg" alt="" style="width:705px;" /></p>
<ul>
<li>zmq_msg_move 做了一个引用计数</li>
</ul>
<h4><a id="multipart-message" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>multipart message</h4>
<ul>
<li>小消息第一个字节是长度</li>
<li>大消息分多帧发送，最后一个帧发送空</li>
<li>超过一个字节的长度，帧第一个字节是0xffff，然后扩充到8个字节</li>
<li>ZMQ_SNDMORE</li>
<li></li>
<li><img src="media/15646523320655/15646590611577.jpg" alt="" style="width:936px;" /></li>
</ul>
<h4><a id="%E5%8A%A8%E6%80%81%E8%B0%83%E6%95%B4%E6%89%B9%E9%87%8F%E5%8F%91%E9%80%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>动态调整批量发送</h4>
<ul>
<li>outbound和inbound是收发队列</li>
<li>out_batch_size = 8192 bytes</li>
<li>有多条消息就合并，没有也立即发送</li>
<li>8192让tcp尽量有数据发送</li>
<li>stream_engine</li>
</ul>
<h4><a id="%E9%AB%98%E6%95%88%E7%BA%BF%E7%A8%8B%E7%9A%84io" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>高效线程的IO</h4>
<ul>
<li>IO密集型一般线程数目是CPU数目的两倍</li>
<li>计算密集型跟cpu数目一样<br />
<img src="media/15646523320655/15649055233553.jpg" alt="" style="width:586px;" /></li>
<li>统计流量的事情丢给用户</li>
</ul>
<pre><code class="language-plain_text">zmq::io_thread_t *zmq::ctx_t::choose_io_thread (uint64_t affinity_)
{
  if (_io_threads.empty ())
    return NULL;

  //  Find the I/O thread with minimum load.
  int min_load = -1;
  io_thread_t *selected_io_thread = NULL;
  for (io_threads_t::size_type i = 0; i != _io_threads.size (); i++) {
    if (!affinity_ || (affinity_ &amp; (uint64_t (1) &lt;&lt; i))) {
      int load = _io_threads[i]-&gt;get_load ();
      if (selected_io_thread == NULL || load &lt; min_load) {
        min_load = load;
        selected_io_thread = _io_threads[i];
      }
    }
  }
  return selected_io_thread;
}
</code></pre>
<h4><a id="mailbox" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mailbox</h4>
<ul>
<li>eventfd 事件fd效果等同于socketpair,可以添加到epoll中来</li>
<li>slot(mailbox)-&gt;io_thread对应数组某个位置</li>
<li>socket线程和io_thread交换数据</li>
<li>通过mailbox命令让io_thread绑定poller,session,engine</li>
<li>signaler_t make_fdpair -&gt; eventfdj</li>
<li>socket的mailbox和iothread中一一对应</li>
<li>mailbox第一次send 1激活邮箱</li>
<li>io_thread中的poller有处理mailbox中的signaler_t信号</li>
<li>然后poller中收到1后从管道中读数据</li>
<li>signaler封装一个socketpair对</li>
</ul>
<h4><a id="mailbox%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF%E6%B5%81%E7%A8%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mailbox发送消息流程</h4>
<ul>
<li><img src="media/15646523320655/15660010884535.jpg" alt="" style="width:628px;" /></li>
<li></li>
</ul>
<h4><a id="%E9%AB%98%E6%95%88io%E7%BC%96%E7%A8%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>高效IO编程</h4>
<ul>
<li>高低水位HWM过载落盘 低水位从磁盘载入</li>
<li>大师级的线程池的设计</li>
<li></li>
</ul>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2019-08-05T17:32:30+08:00" itemprop="datePublished">2019/08/05 17:32 下午</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A0%94%E5%8F%91.html'>linux服务器研发</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="15649975500687.html" itemprop="url">
		Zookeeper</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h4><a id="%E6%A6%82%E5%BF%B5" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>概念</h4>
<ul>
<li>ZooKeeper是一个分布式的，开放源码的分布式集群应用程序协调服务，是Hadoop和Hbase的重要组件。在Zookeeper中，znode是一个跟Unix文件系统路径相似的节点，可以往这个节点存储或获取数据</li>
</ul>
<h4><a id="%E8%8A%82%E7%82%B9%E7%B1%BB%E5%9E%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>节点类型</h4>
<ul>
<li>持久节点</li>
<li>持久顺序节点</li>
<li>临时节点</li>
<li>临时顺序节点</li>
</ul>
<h4><a id="zookeeper" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>zookeeper</h4>
<ul>
<li>配置集中管理</li>
<li>服务注册和发现</li>
<li>可靠性架构设计</li>
<li>分布式锁 排他性 重入性 共享性 创建临时节点的原子性</li>
<li>分布式队列</li>
</ul>
<h4><a id="%E4%B8%80%E8%87%B4%E6%80%A7%E6%96%B9%E6%A1%88" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>一致性方案</h4>
<ul>
<li>ZAB协议需要确保那些已经在Leader服务器上提交的事务最终被所有服务器都提交（已经被处理的消息不能丢，ZXID不同），</li>
<li>ZAB协议需要确保丢弃那些只在Leader服务器上被提出的事务（丢弃的消息不能再次出现，ZXID相同，myid最大的做leader</li>
</ul>
<h4><a id="zookeeper%E7%BC%BA%E9%99%B7" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>zookeeper缺陷</h4>
<ul>
<li>服务发现应该是AP，不是CP</li>
</ul>
<h4><a id="eureka" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>eureka</h4>
<ul>
<li>最终一致性</li>
</ul>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2019-08-05T16:12:56+08:00" itemprop="datePublished">2019/08/05 16:12 下午</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A0%94%E5%8F%91.html'>linux服务器研发</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="15649927761897.html" itemprop="url">
		Nginx模块开发</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h4><a id="%E5%8A%A8%E9%9D%99%E5%88%86%E7%A6%BB" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>动静分离</h4>
<ul>
<li>静态数据放CDN</li>
<li>动态数据 业务接口和实现</li>
</ul>
<h4><a id="%E6%A8%A1%E5%9D%97%E5%BC%80%E5%8F%91" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>模块开发</h4>
<ul>
<li>Handle模块</li>
<li>Filter模块</li>
<li>Upstream模块</li>
<li></li>
</ul>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2019-08-01T18:07:51+08:00" itemprop="datePublished">2019/08/01 18:07 下午</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A0%94%E5%8F%91.html'>linux服务器研发</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="15646540716831.html" itemprop="url">
		zmq</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h4><a id="%E4%BC%A0%E7%BB%9F%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E7%9A%84%E9%97%AE%E9%A2%98" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>传统网络编程的问题</h4>
<ul>
<li>调用的socket接口较多；</li>
<li>TCP是一对一的连接；</li>
<li>编程需要关注很多socket细节问题；</li>
<li>不支持跨平台编程；</li>
<li>需要自行处理分包、组包问题；</li>
<li>流式传输时需处理粘包、半包问题；</li>
<li>需自行处理网络异常，比如连接异常中断、重连等；</li>
<li>服务端和客户端启动有先后 两端是对等的</li>
<li>自行处理IO模型；</li>
<li>自行实现消息的缓存；</li>
<li>自行实现对消息的加密</li>
</ul>
<h4><a id="%E8%AF%BE%E5%A4%96%E9%98%85%E8%AF%BB" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>课外阅读</h4>
<ul>
<li>并发编程的11大问题</li>
<li><a href="https://blog.csdn.net/mergerly/article/details/39028861">https://blog.csdn.net/mergerly/article/details/39028861</a></li>
<li>使用socket_pair</li>
</ul>
<h4><a id="zmq%E8%A7%A3%E5%86%B3%E7%9A%84%E9%97%AE%E9%A2%98" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>zmq解决的问题</h4>
<ul>
<li>传统网络编程问题</li>
<li>并发开发的问题</li>
<li>分布式环境下的通信</li>
<li>吞吐量和延时问题</li>
</ul>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2019-07-18T10:27:49+08:00" itemprop="datePublished">2019/07/18 10:27 上午</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A0%94%E5%8F%91.html'>linux服务器研发</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="15634168691362.html" itemprop="url">
		Epoll实现</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h4><a id="%E9%97%AE%E9%A2%98" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>问题</h4>
<ul>
<li>双向链表和红黑树的线程安全</li>
<li>spinlock</li>
</ul>
<h4><a id="%E6%97%B6%E9%97%B4" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>时间</h4>
<ul>
<li>struct timespec 秒和纳秒</li>
</ul>
<h4><a id="et%E5%92%8Clt%E7%9A%84%E8%A7%A6%E5%8F%91" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>ET和LT的触发</h4>
<ul>
<li>epoll_callback</li>
<li>可读</li>
<li>可写</li>
<li>对端关闭</li>
<li>建立连接</li>
<li>payload&gt;0 会不停的触发回调 水平触发</li>
<li>只调用一次</li>
</ul>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2019-07-16T10:01:29+08:00" itemprop="datePublished">2019/07/16 10:01 上午</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A0%94%E5%8F%91.html'>linux服务器研发</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="15632424892108.html" itemprop="url">
		epoll原理</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h4><a id="%E9%9B%86%E5%90%88" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>集合</h4>
<ul>
<li>A 红黑树IO</li>
<li>B 双向链表</li>
<li>C 所有IO的集合</li>
<li>A = C(包含B)</li>
</ul>
<h4><a id="epoll" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>epoll</h4>
<ul>
<li>epi-&gt;event.events |= event;表示有两个事件</li>
<li>pthread_cond_signal(&amp;ep-&gt;cond)通知触发epoll_wait向下执行</li>
<li>0 不挂起</li>
<li>-1 挂起</li>
<li>正数 等待时间</li>
</ul>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2019-07-11T08:08:06+08:00" itemprop="datePublished">2019/07/11 08:08 上午</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A0%94%E5%8F%91.html'>linux服务器研发</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="15628036865918.html" itemprop="url">
		Epoll高性能封装</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h4><a id="reactor%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reactor设计模式</h4>
<ul>
<li>注册待处理事件epoll_ctl</li>
</ul>
<h4><a id="fd%E7%9A%84%E5%B0%81%E8%A3%85" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>fd的封装</h4>
<ul>
<li>fd的下标封装到数组</li>
</ul>
<h4><a id="%E7%8A%B6%E6%80%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>状态</h4>
<ul>
<li>epoll_state</li>
<li></li>
</ul>


			
			
		</div>

	</article>
 
	<article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
		<div class="meta">
			<div class="date">
				<time datetime="2019-07-08T08:11:32+08:00" itemprop="datePublished">2019/07/08 08:11 上午</time>
			</div>
			<div class="tags">posted in 
			
			    <a class='category' href='linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A0%94%E5%8F%91.html'>linux服务器研发</a>&nbsp;
			 
			</div>
		</div>
		<h1 class="title" itemprop="name"><a href="15625446924822.html" itemprop="url">
		Tcp滑动窗口</a></h1>
		<div class="entry-content" itemprop="articleBody">
			
			<h4><a id="%E5%9C%BA%E6%99%AF%E5%88%86%E6%9E%90" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>场景分析</h4>
<ul>
<li>cwnd创建的时候就确定的</li>
</ul>
<h4><a id="%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E7%A1%AE%E8%AE%A4" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>三次握手确认</h4>
<ul>
<li>rtt,ttl</li>
<li>mss=1024</li>
<li>cwind是指网络承载数据的大小</li>
<li>win是对对端期待接受的数据大小</li>
</ul>
<h4><a id="%E5%9D%9A%E6%8C%81%E5%AE%9A%E6%97%B6%E5%99%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>坚持定时器</h4>
<ul>
<li>push=1是探测包</li>
<li>setsockopt</li>
</ul>
<h4><a id="%E9%80%9A%E8%BF%87%E7%AA%97%E5%8F%A3" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>通过窗口</h4>
<ul>
<li>码流 M</li>
<li>字符数据 K</li>
</ul>
<h4><a id="%E6%85%A2%E5%90%AF%E5%8A%A8%E5%92%8C%E7%BA%BF%E6%80%A7%E5%A2%9E%E9%95%BF" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>慢启动和线性增长</h4>
<ul>
<li>慢启动回一个ack，就增加mss</li>
<li>拥塞控制是经过一个rtt，增加mss，不再依赖ack的数量</li>
</ul>
<h4><a id="%E4%B8%89%E4%B8%AA%E9%87%8D%E5%A4%8D%E7%9A%84%E5%8C%85" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>三个重复的包</h4>
<ul>
<li>丢包 中间的网络拥塞</li>
<li>接收超时</li>
<li>收到重复的包</li>
<li>ack不会重传，syn才会重传</li>
</ul>
<h4><a id="%E8%B6%85%E6%97%B6%E9%87%8D%E4%BC%A0" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>超时重传</h4>
<ul>
<li>经过RTO没有收到任何ACK，会触发超时定时器</li>
</ul>
<h4><a id="%E6%96%AD%E5%BC%80%E9%93%BE%E6%8E%A5" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>断开链接</h4>
<ul>
<li></li>
</ul>


			
			
		</div>

	</article>
  

</div>
<nav id="pagenavi">
	 <a class="prev" href="linux服务器研发.html">Prev</a>  
	 <a class="next" href="linux服务器研发_2.html">Next</a> 
	<div class="center"><a href="archives.html">Blog Archives</a></div>

</nav>

</div>



        </div>
			<footer id="footer" class="inner">Copyright &copy; 2014
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a> &nbsp;&nbsp; 
Theme by <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a>
      </footer>
		</div>
	</div>

  
    



</body>
</html>