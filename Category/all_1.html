<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  eredin-blog
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="eredin-blog" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site: ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="self" href="index.html">Home</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="https://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; eredin-blog</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
        
        <li><a target="self" href="index.html">Home</a></li>
        
        <li><a target="_self" href="archives.html">Archives</a></li>
        

    <li><label>Categories</label></li>

        
            <li><a href="Prometheus.html">Prometheus</a></li>
        
            <li><a href="RocketMQ.html">RocketMQ</a></li>
        
            <li><a href="%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE.html">网络协议</a></li>
        
            <li><a href="Golang.html">Golang</a></li>
        
            <li><a href="Django.html">Django</a></li>
        
            <li><a href="%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90Kubernetes.html">深入剖析Kubernetes</a></li>
        
            <li><a href="%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95.html">数据结构和算法</a></li>
        
            <li><a href="%E5%BE%AE%E6%9C%8D%E5%8A%A1.html">微服务</a></li>
        
            <li><a href="%E6%9E%B6%E6%9E%84.html">架构</a></li>
        
            <li><a href="%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86.html">操作系统原理</a></li>
        
            <li><a href="Mysql%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98.html">Mysql优化实战</a></li>
        
            <li><a href="Kafka.html">Kafka</a></li>
        
            <li><a href="linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A0%94%E5%8F%91.html">linux服务器研发</a></li>
        
            <li><a href="%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86.html">计算机组成原理</a></li>
        
            <li><a href="%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB.html">程序员的自我修养</a></li>
        
            <li><a href="C%E8%AF%AD%E8%A8%80%E8%BF%9B%E9%98%B6.html">C语言进阶</a></li>
        
            <li><a href="http_study.html">http_study</a></li>
        
            <li><a href="%E7%8E%A9%E8%BD%AC%E7%AE%97%E6%B3%95.html">玩转算法</a></li>
        
            <li><a href="C++%E5%AF%B9%E8%B1%A1%E6%A8%A1%E5%9E%8B.html">C++对象模型</a></li>
        
            <li><a href="SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A.html">SQL必知必会</a></li>
        
            <li><a href="Zookeeper.html">Zookeeper</a></li>
        
            <li><a href="Redis%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A.html">Redis从入门到精通</a></li>
        
            <li><a href="%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95%E8%BF%9B%E9%98%B6.html">数据结构和算法进阶</a></li>
        
            <li><a href="Mysql%E6%80%A7%E8%83%BD%E7%AE%A1%E7%90%86%E5%92%8C%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.html">Mysql性能管理和架构设计</a></li>
        
            <li><a href="%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98.html">网络编程实战</a></li>
        
            <li><a href="Redis%E9%AB%98%E5%B9%B6%E5%8F%91%E7%BC%93%E5%AD%98.html">Redis高并发缓存</a></li>
        
            <li><a href="C++%E5%9F%BA%E7%A1%80%E4%B8%8E%E6%8F%90%E9%AB%98.html">C++基础与提高</a></li>
        
            <li><a href="%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%BE%8E.html">设计模式之美</a></li>
        
            <li><a href="Python.html">Python</a></li>
        
            <li><a href="%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html">设计模式</a></li>
        
            <li><a href="Linux%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98.html">Linux性能优化实战</a></li>
        
            <li><a href="%E5%80%99%E6%8D%B7STL.html">候捷STL</a></li>
        
            <li><a href="%E6%80%A7%E8%83%BD%E5%B7%A5%E7%A8%8B%E9%AB%98%E6%89%8B%E8%AF%BE.html">性能工程高手课</a></li>
        
            <li><a href="%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.html">性能测试</a></li>
        
            <li><a href="ElasticSearch.html">ElasticSearch</a></li>
        
            <li><a href="RabbitMQ.html">RabbitMQ</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
	$(function(){
		$('#menu_item_index').addClass('is_active');
	});
</script>
<div class="row">
	<div class="large-8 medium-8 columns">
		<div class="markdown-body home-categories">
		
			<div class="article">
                <a class="clearlink" href="15812339995025.html">
                
                  <h1>定时任务</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<h4>定时器循环任务</h4>

<pre class="line-numbers"><code class="language-python">import time
import datetime
from apscheduler.schedulers.blocking import BlockingScheduler

def func():
   now = datetime.datetime.now()
   ts = now.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;)
   print(&#39;do func time :&#39;,ts)

def func2():
 #耗时2S
   now = datetime.datetime.now()
   ts = now.strftime(&#39;%Y-%m-%d %H:%M:%S&#39;)
   print(&#39;do func2 time：&#39;,ts)

def dojob():
 #创建调度器：BlockingScheduler
 scheduler = BlockingScheduler()
 #添加任务,时间间隔2S
 scheduler.add_job(func, &#39;interval&#39;, seconds=2, id=&#39;test_job1&#39;)
 #添加任务,时间间隔5S
 scheduler.add_job(func2, &#39;interval&#39;, seconds=3, id=&#39;test_job2&#39;)
 scheduler.start()
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2020/02/09 15:39 下午</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='Python.html'>Python</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15812158642858.html">
                
                  <h1>积分系统</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<h4>开发工作</h4>

<ul>
<li>接口设计</li>
<li>数据库设计</li>
<li>业务模型设计</li>
</ul>

<h4>分层架构</h4>

<ul>
<li>Contoller 层、Service 层、Repository 层</li>
<li>Repository 层基于数据库表，而数据库表改动的可能性很小 Entity</li>
<li>Controller 层提供适配给外部使用的接口，代码经常会变动 View Object</li>
<li>Service层  Business Object</li>
</ul>

<h4>设计原则和思想</h4>

<ul>
<li><img src="media/15812158642858/15812161751517.jpg" alt="" style="width:667px;"/></li>
</ul>

<h4>功能划分</h4>

<ul>
<li>根据给定的时间区间，从数据库中拉取数据；</li>
<li>根据原始数据，计算得到统计数据；</li>
<li>将统计数据显示到终端（命令行或邮件）；</li>
<li>定时触发以上 3 个过程的执行。</li>
</ul>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2020/02/09 10:37 上午</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%BE%8E.html'>设计模式之美</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15734291005727.html">
                
                  <h1>Flyweight</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<h4>动机</h4>

<ul>
<li>在软件系统采用纯粹对象方案的问题在于大量细粒度的对象会很快充斥在系统中，从而带来很高的运行时代价一一主要指内存需求方面的代价。</li>
<li>如何在避免大量细粒度对象问题的同时，让外部客户程序仍然能够透明地使用面向对象的方式来进行操作？</li>
</ul>

<h4>结构</h4>

<ul>
<li><img src="media/15734291005727/15734293143425.jpg" alt="" style="width:664px;"/></li>
</ul>

<h4>要点总结</h4>

<ul>
<li><p>面向对象很好地解决了抽象性的问题，但是作为一个运行在机器中的程序实体，我们需要考虑对象的代价问题。Flyweight 主要解决面向对象的代价问题，一般不触及面向对象的抽象性问题。</p></li>
<li><p>Flyweight 采用对象共享的做法来降低系统中对象的个数，从而降低细粒度对象给系统带来的内存压力。在具体实现方面，要注意对象状态的处理。</p></li>
<li><p>对象的数量太大从而导致对象内存开销加大ー一什么样的数量才算大？这需要我们仔细的根据具体应用情况进行评估，而不能凭空臆断。</p></li>
</ul>

<h4>golang_demo</h4>

<pre class="line-numbers"><code class="language-go">package design_pattern

import &quot;fmt&quot;

type WebUser struct {
    name string
}

type WebSite interface {
    Use(*WebUser)
}

type ConcreteWebsite struct {
    name string
}

func (c *ConcreteWebsite) Use(user *WebUser) {
    fmt.Println(&quot;Web type &quot;, c.name, &quot; UserName &quot;, user.name)
}

type NetWebSite struct {
    *ConcreteWebsite
}

func NewNetWebsite(name string) WebSite {
    return &amp;NetWebSite{
        ConcreteWebsite: &amp;ConcreteWebsite{name: name},
    }
}

type WebFactory struct {
    factory map[string]WebSite
}

func NewWebFactory() *WebFactory {
    return &amp;WebFactory {
        factory: make(map[string]WebSite),
    }
}

func (w *WebFactory) GetWebsiteCategory(key string) WebSite {
    if _, ok := w.factory[key]; !ok {
        webSite := NewNetWebsite(key)
        w.factory[key] = webSite
        println(&quot;create new product&quot;)
    }

    return w.factory[key]
}

func TestFlyWeight(t *testing.T) {
    factory := NewWebFactory()

    f1 := factory.GetWebsiteCategory(&quot;product show&quot;)
    f1.Use(&amp;WebUser{&quot;ming&quot;})

    f2 := factory.GetWebsiteCategory(&quot;product show&quot;)
    f2.Use(&amp;WebUser{&quot;zong&quot;})

    f3 := factory.GetWebsiteCategory(&quot;discus&quot;)
    f3.Use(&amp;WebUser{&quot;jim&quot;})

    f4 := factory.GetWebsiteCategory(&quot;discus&quot;)
    f4.Use(&amp;WebUser{&quot;bob&quot;})
}
</code></pre>

<h4>python_code</h4>

<pre class="line-numbers"><code class="language-python">from abc import ABCMeta, abstractmethod

class WebUser(object):

    def __init__(self, name):
        self.name = name


class WebSite(metaclass=ABCMeta):

    @abstractmethod
    def use(self, user):
        pass

class ConcreteWebsite(WebSite):

    def __init__(self, name):
        self.name = name

    def use(self, user):
        print(&#39;Web type {} {}&#39;.format(self.name, user.name))


class WebFactory(object):

    def __init__(self):
        self.factory = {}

    def get_website_category(self, key):
        if key not in self.factory:
            print(&#39;create new website&#39;)
            self.factory[key] = ConcreteWebsite(key)
        return self.factory[key]

if __name__ == &#39;__main__&#39;:
   factory = WebFactory()

   f1 = factory.get_website_category(&quot;product show&quot;)
   f1.use(WebUser(&#39;ming&#39;))

   f2 = factory.get_website_category(&quot;product show&quot;)
   f2.use(WebUser(&#39;ming&#39;))

   f3 = factory.get_website_category(&quot;discus&quot;)
   f3.use(WebUser(&#39;ming&#39;))
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2019/11/11 07:38 上午</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html'>设计模式</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15736874304748.html">
                
                  <h1>Facade</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<h4>接口隔离模式</h4>

<ul>
<li>在组件构建过程中，某些接口之间直接的依赖常常会带来很多题、甚至根本无法实现。采用添加一层间接（稳定）接口，来隔离本来互相紧密关联的接口是一种常见的解決方案。</li>
</ul>

<h4>系统间耦合的复杂度</h4>

<ul>
<li>方案的问题在于组件的客户和组件中各种复杂的子系统有了过多的耦合，随着外部客户程序和各子系统的演化，这种过多的耦合面临很多变化的挑战。</li>
</ul>

<h4>结构</h4>

<ul>
<li><img src="media/15736874304748/15807223678610.jpg" alt="" style="width:636px;"/></li>
</ul>

<h4>要点总结</h4>

<ul>
<li>从客户程序的角度来看，Facade 模式简化了整个组件系统的接口对于组件内部与外部客户程序来说达到了种“解耦”果内部学系统的程何雯化不会影到 Facades 接口的变</li>
<li>Facade 设计模式更注重从架构的层次去看整个系统，而不是单个类的层次。Facade 很多时候更是一种架构</li>
<li>Facade 设计模式并非、个集装箱，可以任意地放进任何多个对象。Facade 模式中组件的内部应该是、相互合关比较大的一系列组件”，而不是简单的功能集合</li>
</ul>

<h4>cpp_demo</h4>

<pre class="line-numbers"><code class="language-cpp">//
// Created by 刘超 on 2019-11-14.
//
#include &lt;iostream&gt;

class SubSystem1 {
public:
    SubSystem1() {}
    ~SubSystem1() {}

    void Operation() {std::cout &lt;&lt; &quot;Subsystem1 operation...&quot; &lt;&lt; std::endl;}
};

class SubSystem2 {
public:
    SubSystem2() {}
    ~SubSystem2() {}
    void Operation() {std::cout &lt;&lt; &quot;Subsystem2 operation...&quot; &lt;&lt; std::endl;}
};

class Facade {
public:
    Facade() {
        sub1 = new SubSystem1();
        sub2 = new SubSystem2();
    }

    ~Facade();
    void OperatonWrapper() {
        sub1-&gt;Operation();
        sub2-&gt;Operation();
    }
    SubSystem1* sub1;
    SubSystem2* sub2;
};

int main() {
    Facade* f =  new Facade();
    f-&gt;OperatonWrapper();
}
</code></pre>

<h4>go_demo</h4>

<pre class="line-numbers"><code class="language-go">package desian_pattern_practise

import &quot;reflect&quot;

type Subsystem1 struct {
}

func (s *Subsystem1) Operation() {
    println(reflect.TypeOf(s).String() + &quot; Operation&quot;)
}

type Subsystem2 struct {
}

func (s *Subsystem2) Operation() {
    println(reflect.TypeOf(s).String() + &quot; Operation&quot;)
}

type Facade struct {
    sub1 *Subsystem1
    sub2 *Subsystem2
}

func (f *Facade) Operation() {
    f.sub1.Operation()
    f.sub2.Operation()
}

func NewFacade() *Facade {
    return &amp;Facade{
        sub1: &amp;Subsystem1{},
        sub2: &amp;Subsystem2{},
    }
}
</code></pre>

<h4>python_demo</h4>

<pre class="line-numbers"><code class="language-python">from abc import ABCMeta, abstractmethod

class SubSystem1(object):

    def operation(self):
        print(&#39;Subsystem1 operation&#39;)

class SubSystem2(object):

    def operation(self):
        print(&#39;Subsystem2 operation&#39;)

class Facade(object):

    def __init__(self):
        self.sub1 = SubSystem1()
        self.sub2 = SubSystem2()

    def operation_wrapper(self):
        self.sub1.operation()
        self.sub2.operation()

if __name__ == &#39;__main__&#39;:
    facade = Facade()
    facade.operation_wrapper()
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2019/11/14 07:23 上午</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html'>设计模式</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15737733784968.html">
                
                  <h1>Proxy</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<h4>动机</h4>

<ul>
<li>在面向对象系统中，有些对象由于某种原因（比如对象创建的开消很大，或者某些操作需要安全控制，或者需要进程外的访问等）直接访问会给使用者、或者系统结构带来很多麻烦。</li>
<li>如何在不失去透明操作对象的同时来管理/控制这些对象特有的复杂性？增加一层间接层是软件开发中常见的解決方式。</li>
</ul>

<h4>结构</h4>

<ul>
<li><img src="media/15737733784968/15807036463940.jpg" alt="" style="width:705px;"/></li>
</ul>

<h4>要点总结</h4>

<ul>
<li><img src="media/15737733784968/15737741074243.jpg" alt="" style="width:842px;"/></li>
</ul>

<h4>cpp_demo</h4>

<pre class="line-numbers"><code class="language-cpp">#include &lt;iostream&gt;

class ITelco {
public:
    virtual ~ITelco() {}

    virtual  void Recharge(int money) = 0;
};

class CMCC : public ITelco {
public:
    void Recharge(int money) override  {
        std::cout &lt;&lt; &quot;Recharge &quot; &lt;&lt; money &lt;&lt; std::endl;
    }
};

class Proxy : public ITelco {
public:
    Proxy() : m_pcMCC(nullptr) {}

    void  Recharge(int money) override {
       if (money &gt;= 50) {
           if (m_pcMCC == nullptr)
               m_pcMCC = new CMCC();
           m_pcMCC-&gt;Recharge(money);
       } else {
           std::cout &lt;&lt; &quot;Sorry, too little money &quot; &lt;&lt; std::endl;
       }
    }

public:
    CMCC* m_pcMCC;
};

int main() {
    Proxy* proxy = new Proxy();
    proxy-&gt;Recharge(20);
    proxy-&gt;Recharge(100);
}
</code></pre>

<h4>golang_demo</h4>

<pre class="line-numbers"><code class="language-go">import &quot;fmt&quot;

tyecharge(money int) {
    fmt.Println(&quot;CMCC Recharge money &quot;, money)
}

type ProxySub struct {
    cmcc *ClientAPP
}

func (p *ProxySub) Recharge(money int) {
    if money &gt;= 50 {
        if p.cmcc == nil {pe Subject1 interface {
        Recharge(money int)
        }

            type ClientAPP struct{}

            func (c *ClientAPP) R
            p.cmcc = &amp;ClientAPP{}
        }
        p.cmcc.Recharge(money)
    } else {
        fmt.Println(&quot;Sorry too littel money&quot;)
    }
}
func TestProxySub(t *testing.T) {
    var proxy Subject1
    proxy = &amp;ProxySub{}
    proxy.Recharge(30)
    proxy.Recharge(100)
}
</code></pre>

<h4>golang_demo</h4>

<pre class="line-numbers"><code class="language-go">package desian_pattern_practise

import &quot;fmt&quot;

type IPSubject interface {
    Request(string)
}

type PSubject struct {
    name string
}

type RealSubject struct {
    *PSubject
}

func (r *RealSubject) Request(content string) {
    fmt.Println(&quot;RealSubject handle content&quot;, content)
}

type ProxySubject struct {
    *PSubject
    realSubject IPSubject
}

func NewRealSubject(name string) *RealSubject {
    return &amp;RealSubject{
        PSubject: &amp;PSubject{name: name},
    }
}

func (p *ProxySubject) Request(content string) {
    p.preRequest()
    if p.realSubject != nil {
        p.realSubject.Request(content)
    }
    p.afterRequest()
}

func NewProxySubject(name string, subject IPSubject) *ProxySubject {
    return &amp;ProxySubject{
        PSubject: &amp;PSubject{name: name},
        realSubject: subject,
    }
}

func (p *ProxySubject) preRequest() {
    println(&quot;pre request&quot;)
}

func (p *ProxySubject) afterRequest() {
    println(&quot;after request&quot;)
}

func TestProxySubject_Request(t *testing.T) {
    realObj := NewRealSubject(&quot;realSubject&quot;)
    proxySubject := NewProxySubject(&quot;ProxySubject&quot;, realObj)
    proxySubject.Request(&quot;Html world&quot;)
}
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2019/11/15 07:16 上午</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html'>设计模式</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15738632806643.html">
                
                  <h1>Adapter</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<h4>动机</h4>

<ul>
<li><p>在软件系统中，由于应用环境的变化，常常需要将““一些现存的对象”放在新的环境中应用，但是新环境要求的接口是这些现存对象所不满足的</p></li>
<li><p>如何应对这种“迁移的变化“？如何既能利用现有对象的良好实现，同时又能满足新的应用环境所要求的接口？</p></li>
</ul>

<h4>结构</h4>

<p><img src="media/15738632806643/15808782023371.jpg" alt="" style="width:1193px;"/></p>

<h4>要点总结</h4>

<ul>
<li>Adapters 模式主要应用于“希望复用一些现存的类，但是接口又与</li>
<li>复用环境要求不一致的情況”，在遗留代码复用、类库注移等方面非常有用。</li>
<li>GoF23 采用了两种 Adapter 模式的实现结构：对象和适配器。但类适配器采用“多继承”的实现方式般不推荐使用。对象适配器采用“对象组合“的方式，更符合松耦合精神。</li>
<li>Adapter 模式可以实现的非常灵活，不必拘泥于 Gof23 中定义的两种结构。例如，完全可以将 Adapter 模式中现存对象”作为新的接口方法参数，来达到适配的目的。</li>
<li>对象适配器比类适配器好</li>
</ul>

<h4>Cpp_demo</h4>

<pre class="line-numbers"><code class="language-cpp">//
// Created by eredinliu on 2020-02-05.
//
#include &lt;iostream&gt;
using namespace std;

class IAdapter {
public:
    virtual void Charge() = 0;
    IAdapter() {}
};

class ITarget {
public:
    virtual void Process() = 0;
    ITarget(IAdapter* adapter) : adapter_(adapter) {}
protected:
    IAdapter* adapter_;
};

class CNCharge : public IAdapter {
public:
    CNCharge() {}

    void Charge() {
        cout &lt;&lt; typeid(this).name() &lt;&lt; &quot; Charge \n&quot;;
    }
};

class USCharge : public ITarget {
public:
    USCharge(IAdapter* adapter) : ITarget(adapter) {}

    void Process() {
        cout &lt;&lt; typeid(this).name() &lt;&lt; &quot; Process \n&quot;;
        this-&gt;adapter_-&gt;Charge();
    }
};

int main() {
    IAdapter* cn_charge = new CNCharge();
    ITarget* target = new USCharge(cn_charge);
    target-&gt;Process();
}
</code></pre>

<h4>golang_demo</h4>

<pre class="line-numbers"><code class="language-go">type ITarget interface {
    Process()
}

type IAdapter interface {
    Charge()
}

type CNCharge struct {
}

func (c *CNCharge) Charge() {
    println(reflect.TypeOf(c).String() + &quot; Charge&quot;)
}

type USCharge struct {
    IAdapter
}

func (u *USCharge) Process() {
    println(reflect.TypeOf(u).String() + &quot; Process&quot;)
    u.IAdapter.Charge()
}

func NewUSCharge(adapter IAdapter) *USCharge {
    return &amp;USCharge{
        IAdapter: adapter,
    }
}


func TestAdapter_Request2(t *testing.T) {
    cnCharge := &amp;CNCharge{}
    target := NewUSCharge(cnCharge)
    target.Process()
}
</code></pre>

<h4>python_code</h4>

<pre class="line-numbers"><code class="language-python">from abc import ABCMeta, abstractmethod

class ITarget(metaclass=ABCMeta):

    @abstractmethod
    def process(self):
        pass

    def __init__(self, adapter):
        self.adapter = adapter

class IAdapter(metaclass=ABCMeta):

    @abstractmethod
    def charge(self):
        pass

class CNCharge(IAdapter):

    def charge(self):
        print(type(self).__name__ + &#39; charge&#39;)

class USCharge(ITarget):

    def __init__(self, adapter):
        super().__init__(adapter)

    def process(self):
        print(type(self).__name__ + &#39; process&#39;)
        self.adapter.charge()

if __name__ == &#39;__main__&#39;:
    cn_charge = CNCharge()
    target = USCharge(cn_charge)
    target.process()
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2019/11/16 08:14 上午</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html'>设计模式</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15742917885791.html">
                
                  <h1>中介模式</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<h4>动机</h4>

<ul>
<li>在软件构建过程中，经常会出现多个对象互相关联交互的情况，对象之间常常会维持一种复杂的引用关系，如果遇到一些需求的更改，这种直接的引用关系将面临不断的变化。</li>
<li>在这种情況下，我们可使用一个“中介对象”来管理对象间的关联关系，避免相互交互的对象之间的紧耦合引用关系，从而更好地抵御变化。</li>
</ul>

<h4>模式定义</h4>

<ul>
<li>用一个中介对象来封装（封装变化）一系列的对象交互。中介者使各对象不需要显式的相互引用（编译时依赖运行时依赖），从而使其耦合松散（管理变化），而且可以独立地改变它们之间的交互</li>
<li>编译时依赖改成运行时依赖</li>
</ul>

<h4>结构</h4>

<p><img src="media/15742917885791/15803924036000.jpg" alt="" style="width:758px;"/></p>

<p><img src="media/15742917885791/15742924128916.jpg" alt="" style="width:986px;"/></p>

<h4>要点总结</h4>

<ul>
<li><p>将多个对象间复杂的关联关系解耦，Mediator 模式将多个对象间的控制逻辑进行集中管理，变“多个对象互相关联“为“多个对象和一个中介者关联“，简化了系统的维护，抵御了可能的变化。</p></li>
<li><p>随着控制逻辑的复杂化，Mediator 具体对象的实现可能相当复杂。这时候可以对 Mediator 对象进行分解处理。</p></li>
<li><p>Facade 模式是解耦系统（单向）的对象关联关系；Mediator 模式是解耦系统内各个对象之间（双向）的关联关系。</p></li>
</ul>

<h4>golang_demo</h4>

<pre class="line-numbers"><code class="language-go">package desian_pattern_practise

import (
    &quot;reflect&quot;
    &quot;strings&quot;
    &quot;sync&quot;
)

var (
    mediator *Mediator
    monce sync.Once
)
type IColleague interface {
    GetMediator()
}

type Colleague struct {
    mediator IMediator
}


type IMediator interface {
    Execute(IColleague)
}

type Mediator struct {
    cd, cpu, videoCard, soundCard IColleague
}

func (m *Mediator) SetCD(cd IColleague) {
    m.cd = cd
}

func (m *Mediator) SetCpu(cpu IColleague) {
    m.cpu = cpu
}

func (m *Mediator) SetVideoCard(videoCard IColleague) {
    m.videoCard = videoCard
}

func (m *Mediator) SetSoundCard(soundCard IColleague) {
    m.soundCard = soundCard
}

func GetMediator() *Mediator {
    monce.Do(func() {
        mediator = &amp;Mediator{}
    })
    return mediator
}

func (m *Mediator) Execute(i IColleague) {
    switch i.(type) {
    case *CDDriver:
        m.cpu.(*Cpu).Process(i.(*CDDriver).data)
    case *Cpu:
        m.soundCard.(*SoundCard).Play(i.(*Cpu).audio)
        m.videoCard.(*VideoCard).Display(i.(*Cpu).video)
    }
}

type CDDriver struct {
    *Colleague
    data string
}

func NewCDDriver() *CDDriver {
    return &amp;CDDriver{
        Colleague: &amp;Colleague{
            mediator: GetMediator(),
        },
    }
}

func (c *CDDriver) GetMediator() {}

func (c *CDDriver) ReadData() {
    c.data = &quot;music, image&quot;
    println(reflect.TypeOf(c).String() + &quot; reading data&quot;)
    c.mediator.Execute(c)
}

type Cpu struct {
    *Colleague
    video, audio string
}

func NewCpu() *Cpu{
    return &amp;Cpu {
        Colleague: &amp;Colleague{
            mediator: GetMediator(),
        },
    }
}

func (c *Cpu) GetMediator() {}

func (c *Cpu) Process(data string) {
    sp := strings.Split(data, &quot;,&quot;)
    c.video = sp[1]
    c.audio = sp[0]
    println(reflect.TypeOf(c).String() + &quot; video &quot; + c.video + &quot; audio &quot;, c.audio)
    c.mediator.Execute(c)
}

type VideoCard struct {
    *Colleague
}

func NewVideoCard() *VideoCard{
    return &amp;VideoCard {
        Colleague: &amp;Colleague{
            mediator: GetMediator(),
        },
    }
}

func (v *VideoCard) GetMediator() {}

func (v *VideoCard) Display(data string) {
    println(reflect.TypeOf(v).String() + &quot; display data &quot;, data)
    v.mediator.Execute(v)
}

type SoundCard struct {
    *Colleague
}

func NewSoundCard() *SoundCard {
    return &amp;SoundCard {
        Colleague: &amp;Colleague{
            mediator: GetMediator(),
        },
    }
}

func (v *SoundCard) GetMediator() {}

func (v *SoundCard) Play(data string) {
    println(reflect.TypeOf(v).String() + &quot; play data &quot;, data)
    v.mediator.Execute(v)
}

package desian_pattern_practise

import &quot;testing&quot;

func TestMediator_Execute(t *testing.T) {
    cd:= NewCDDriver()
    cpu := NewCpu()
    soundCard := NewSoundCard()
    videoCard := NewVideoCard()
    GetMediator().SetCD(cd)
    GetMediator().SetCpu(cpu)
    GetMediator().SetSoundCard(soundCard)
    GetMediator().SetVideoCard(videoCard)
    cd.ReadData()
}
</code></pre>

<h4>cpp_demo</h4>

<pre class="line-numbers"><code class="language-cpp">//
// Created by eredinliu on 2020-01-31.
//
#include &lt;iostream&gt;
#include &lt;mutex&gt;
#include &lt;typeinfo&gt;
#include &lt;boost/algorithm/string.hpp&gt;
#include &lt;vector&gt;

using namespace std;
using namespace boost;

class Mediator;
class Colleague {
public:
    Colleague(Mediator* _mediator) : mediator(_mediator) {}

protected:
    Mediator* mediator;
};

class Cpu;
class CDDriver;
class VideoCard;
class SoundCard;

class Mediator {
public:
    static Mediator* mediator;

    static Mediator* GetMediator() {
        static once_flag flag;
        call_once(flag, [&amp;](){mediator = new Mediator();});
        return mediator;
    }

    void SetCD(CDDriver* cd) {this-&gt;cd = cd;}

    void SetCpu(Cpu* cpu) {this-&gt;cpu = cpu;}

    void SetVideoCard(VideoCard* video) {this-&gt;videoCard = video;}

    void SetSoundCard(SoundCard* sound) {this-&gt;soundCard = sound;}

    void Execute(Colleague* colleague);
private:
    CDDriver* cd;
    Cpu* cpu;
    VideoCard *videoCard;
    SoundCard *soundCard;
    Mediator() {}
};

Mediator* Mediator::mediator = nullptr;

class CDDriver : public Colleague {
public:
    CDDriver(Mediator* _mediator) : Colleague(_mediator) {}

    void ReadData() {
        this-&gt;data = &quot;Music,Image&quot;;
        cout &lt;&lt; typeid(this).name() &lt;&lt; &quot; reading data&quot; &lt;&lt; endl;
        this-&gt;mediator-&gt;Execute(this);
    }

    string&amp; GetData() {
        return this-&gt;data;
    }
private:
    string data;
};

class Cpu : public Colleague {
public:
    friend class Mediator;
    Cpu(Mediator* _mediator) : Colleague(_mediator) {}

    void Process(string&amp; data) {
        vector&lt;string&gt; str_vec;
        split(str_vec, data, is_any_of(&quot;,&quot;));
        this-&gt;video = str_vec[1];
        this-&gt;sound = str_vec[0];
        cout &lt;&lt; typeid(this).name() &lt;&lt; &quot; video &quot; &lt;&lt; this-&gt;video &lt;&lt; &quot; sound &quot;
        &lt;&lt; this-&gt;sound &lt;&lt; endl;
        this-&gt;mediator-&gt;Execute(this);
    }

    string&amp; GetVideo() {return this-&gt;video;}

    string&amp; GetSound() {return this-&gt;sound;}
private:
    string video, sound;
};

class VideoCard : public Colleague {
public:
    VideoCard(Mediator* _mediator) : Colleague(_mediator) {}

    void Process(string&amp; data) {
        cout &lt;&lt; typeid(this).name() &lt;&lt; &quot; display &quot; &lt;&lt; data &lt;&lt; endl;
        this-&gt;mediator-&gt;Execute(this);
    }
};

class SoundCard : public Colleague {
public:
    SoundCard(Mediator* _mediator) : Colleague(_mediator) {}

    void Process(string&amp; data) {
        cout &lt;&lt; typeid(this).name() &lt;&lt; &quot; play &quot; &lt;&lt; data &lt;&lt; endl;
        this-&gt;mediator-&gt;Execute(this);
    }
};

void Mediator::Execute(Colleague* colleague) {
    if (colleague == cd) {
        cpu-&gt;Process(cd-&gt;GetData());
    } else if (colleague == cpu){
        soundCard-&gt;Process(cpu-&gt;GetSound());
        videoCard-&gt;Process(cpu-&gt;GetVideo());
    }
}

int main() {
    Mediator* mediator = Mediator::GetMediator();
    CDDriver* cd = new CDDriver(mediator);
    Cpu* cpu = new Cpu(mediator);
    SoundCard* soundCard = new SoundCard(mediator);
    VideoCard* videoCard = new VideoCard(mediator);
    mediator-&gt;SetCD(cd);
    mediator-&gt;SetCpu(cpu);
    mediator-&gt;SetSoundCard(soundCard);
    mediator-&gt;SetVideoCard(videoCard);
    cd-&gt;ReadData();
}
</code></pre>

<h4>python_code</h4>

<pre class="line-numbers"><code class="language-python">from abc import ABCMeta, abstractmethod

class Colleague(object):

    def __init__(self, mediator):
        self.mediator = mediator


def singleton(cls, *args, **kwargs):
    instance = {}

    def __singleton(*args, **kwargs):
        if cls not in instance:
            instance[cls] = cls(*args, **kwargs)
        return instance[cls]

    return __singleton

@singleton
class Mediator(object):

    def __init__(self):
        self.__cd = self.__cpu = self.__video_card = self.__sound_card = None

    def set_cd(self, cd):
        self.__cd  = cd

    def set_cpu(self, cpu):
        self.__cpu = cpu

    def set_video_card(self, video_card):
        self.__video_card = video_card

    def set_sound_card(self, sound_card):
        self.__sound_card = sound_card

    def execute(self, colleague):
        if colleague == self.__cd:
            self.__cpu.process(self.__cd.get_data())
        elif colleague == self.__cpu:
            self.__sound_card.process(colleague.get_sound())
            self.__video_card.process(colleague.get_video())

class CDDriver(Colleague):

    def __init__(self, mediator):
        super().__init__(mediator)
        self.__data = &#39;&#39;

    def read_data(self):
        self.__data = &#39;Music,Image&#39;
        print(type(self).__name__, &quot; reading data&quot;)
        self.mediator.execute(self)

    def get_data(self):
        return self.__data

class Cpu(Colleague):

    def __init__(self, mediator):
        super().__init__(mediator)
        self.__video = self.__sound = &#39;&#39;

    def process(self, data):
        ret = data.split(&#39;,&#39;)
        self.__video = ret[1]
        self.__sound = ret[0]
        print(type(self).__name__, &quot; video {} sound {}&quot;.format(self.__video, 
                                                               self.__sound))

        self.mediator.execute(self)

    def get_video(self):
        return self.__video

    def get_sound(self):
        return self.__sound


class VideoCard(Colleague):

    def __init__(self, mediator):
        super().__init__(mediator)

    def process(self, data):
        print(type(self).__name__, &quot; display {}&quot;.format(data))


class SoundCard(Colleague):

    def __init__(self, mediator):
        super().__init__(mediator)

    def process(self, data):
        print(type(self).__name__, &quot; play {}&quot;.format(data))

if __name__ == &#39;__main__&#39;:
    mediator = Mediator()
    cd = CDDriver(mediator)
    cpu = Cpu(mediator)
    sound_card = SoundCard(mediator)
    video_card = VideoCard(mediator)
    mediator.set_cd(cd)
    mediator.set_cpu(cpu)
    mediator.set_sound_card(sound_card)
    mediator.set_video_card(video_card)
    cd.read_data()
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2019/11/21 07:16 上午</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html'>设计模式</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15700989065972.html">
                
                  <h1>lambda</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<h4>特点</h4>

<ul>
<li>是个匿名函数, 可调用的代码单元</li>
<li>返回类型可以自动推导，可以省略</li>
<li>没有参数的时候()可以省略·</li>
</ul>

<pre class="line-numbers"><code class="language-cpp">auto f = [](int a)-&gt;int {
    return a + 1;
  };

  auto f1 = [](int a) {
    return a + 1;
  };

  auto f2 = [] {return  2;};
</code></pre>

<h4>捕获列表</h4>

<ul>
<li>捕获一定范围内的变量</li>
<li>lambda可以捕获局部静态变量</li>
</ul>

<pre class="line-numbers"><code class="language-cpp">  static int i = 9;
  auto f3 = [] {
    return i;
  };

</code></pre>

<ul>
<li>[&amp;] 捕获所有外部变量</li>
</ul>

<pre class="line-numbers"><code class="language-cpp">  int j = 9;
  auto f4 = [&amp;] {
    j = 10;
  };
  f4();
</code></pre>

<ul>
<li>[=] 值使用，只能用，不能修改</li>
</ul>

<pre class="line-numbers"><code class="language-cpp">auto f5 = [=] {
    cout &lt;&lt; &quot;j &quot; &lt;&lt; j &lt;&lt; endl;
  };
  f5();

</code></pre>

<ul>
<li>[this] 用于类中，拥有和成员函数一样的权限</li>
<li>[变量名] 表示按值捕获，同时不捕获其他变量，按值分隔</li>
</ul>

<pre class="line-numbers"><code class="language-cpp">class CT {
 public:
  int m_i = 5;
  void func(int x, int y) {
    //auto ld = [this] {
    //auto ld = [this, x, y] {
    auto ld = [this, &amp;x, &amp;y] {
      x = 5;
      y = 2;
      return m_i;
    };
  }
};
</code></pre>

<ul>
<li>[=,&amp;变量名] 按值捕获所有变量, 但按引用捕获&amp;中所指的变量，第一个都是默认捕获，隐式捕获方式，其他的是显式捕获，后面的引用方式是相反的[&amp;,x]</li>
</ul>

<pre class="line-numbers"><code class="language-cpp"> int x = 2, y = 3;
  auto f6 = [=, &amp;x, &amp;y] {
    cout &lt;&lt; &quot;j &quot; &lt;&lt; j &lt;&lt; endl;
  };
  f6();

  auto f7 = [&amp;, x, y] {
    cout &lt;&lt; &quot;j &quot; &lt;&lt; j &lt;&lt; endl;
  };
  f6();
</code></pre>

<h4>lambda表达式延迟调用易出错</h4>

<pre class="line-numbers"><code class="language-cpp">  int x1 = 5;
  auto f8 = [=] {
    return x1;
  };
  x1 = 10;
  cout &lt;&lt; f8() &lt;&lt; endl;//5
</code></pre>

<ul>
<li>lamda表达式引用外部变量的那一刻，复制了一份存储在表达式中</li>
<li>如果采用引用，就不会出错</li>
</ul>

<pre class="line-numbers"><code class="language-cpp"> int x1 = 5;
  auto f8 = [&amp;] {
    return x1;
  };
  x1 = 10;
  cout &lt;&lt; f8() &lt;&lt; endl;//5
</code></pre>

<h4>mutable</h4>

<pre class="line-numbers"><code class="language-cpp">  int x2 = 5;
  auto f9 = [=]() mutable {
    x2 = 7;
    return x2;
  };
  cout &lt;&lt; f9() &lt;&lt; endl;
</code></pre>

<ul>
<li>可以修改按值捕获的变量</li>
</ul>

<h4>表达式类型和存储</h4>

<ul>
<li>Closure Type</li>
<li>闭包 函数内的函数，本质就是lambda表达式创建时运行时间对象</li>
<li>闭包类的类型的对象，可以认为是带有operator()的类型的对象</li>
</ul>

<pre class="line-numbers"><code class="language-cpp">int x = 5;
auto f = [&amp;] {
  return x;
}

function&lt;int(int)&gt; fc1 = [](int t) {return  t;};
  cout &lt;&lt; fc1(15) &lt;&lt; endl;
function&lt;int(int)&gt; fc2 = bind(
      [](int t) {
      return t;
      },
      16
      );
</code></pre>

<h4>总结</h4>

<pre class="line-numbers"><code class="language-cpp">  vector&lt;int&gt; vec = {10,20,30,40,50};
  int sum = 0;
  for_each (vec.begin(), vec.end(), [&amp;sum](int val) {
            sum += val;
            cout &lt;&lt; val &lt;&lt; endl;
            });
  cout &lt;&lt; &quot; sum &quot; &lt;&lt; sum &lt;&lt; endl;

  find_if (vec.begin(), vec.end(), [](int val) {
           cout &lt;&lt; val &lt;&lt; endl;
           if (val &gt; 15)
              return true;
           return false;
           });
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2019/10/03 18:35 下午</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='C++%E5%9F%BA%E7%A1%80%E4%B8%8E%E6%8F%90%E9%AB%98.html'>C++基础与提高</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15775908801763.html">
                
                  <h1>Command</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<h4>行为变化模式</h4>

<ul>
<li>在组件的构建过程中，组件行为的变化经常导致组件本身剧烈的变化。“行为变化“模式将组件的行为和组件本身进行解耦，从而支持组件行为的变化，实现两者之间的松耦合。</li>
</ul>

<h4>动机</h4>

<ul>
<li>在软件构建过程中，“行为请求者”与“行为实现者通常呈现一种“紧耦合”。但在某些场合一一比如需要对行为进行“记录、撤销/重（undo/redo)、事务”等处理,这种无法抵御变化的紧耦合是不合适 的</li>
<li>在这种情况下，如何将“行为请求者“与“行为实现者”解耦？将一组行为抽象为对象，可以实现二者之间的松耦合。</li>
</ul>

<h4>模式定义</h4>

<ul>
<li>将一个请求（行为）封装为一个对象，从而使你可用不同的请求对客户进行参数化；对请求排队或记录请求日志，以及支持可撇销的操作。</li>
</ul>

<h4>结构</h4>

<ul>
<li><img src="media/15775908801763/15811582346417.jpg" alt="" style="width:787px;"/></li>
</ul>

<h4>要点总结</h4>

<ul>
<li>Command 模式的根本目的在于将“行为请求者”与“行为实现者”解耦，在面向对象语言中，常见的实现手段是“将行为抽象为对象</li>
<li>实现 Command 接口的具体命令对象 Concrete Command 有时侯根据需要可能会保存一些额外的状态信息。通过使用 Composite 模式可以将多个“命令“封装为ー个“复合命令“Macro Command</li>
<li>Command 模式与 C++中的函数对象有些类似。但两者定义行为接口的规范有所区别：Command 以面向对象中的“接口-实现”来定义行为接口规范，更严格，但有性能损失；C++函数对象以函数签名来定义行为接口规范，更灵活，性能更高。</li>
<li>编译时多态</li>
<li>范形编程+函数对象解决了迭代器模式和命令模式</li>
<li>设计模式是弥补语言设计的不足出现的</li>
</ul>

<h4>优缺点</h4>

<h5>优点</h5>

<ul>
<li>将调用操作的类与知道如何执行该操作的对象解耦；</li>
<li>提供队列系统后，可以创建一系列命令；</li>
<li>添加新命令更加容易，并且无需更改现有代码；</li>
<li>还可以使用命令模式来定义回滚系统，例如，在向导示例中，我们可以编写一个回滚方法。</li>
</ul>

<h6>缺点：</h6>

<ul>
<li>为了实现目标，需要大量的类和对象进行协作。应用程序开发人员为了正确开发这些类，需要倍加小心；</li>
<li>每个单独的命令都是一个ConcreteCommand类，从而增加了需要实现和维护的类的数量。</li>
</ul>

<h4>cpp_code</h4>

<pre class="line-numbers"><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;list&gt;
using namespace std;

class Command {
    public:
    virtual void execute() = 0;
    Command() {}
};

class Barbecue {
    public:
    void bake_mutton() {cout &lt;&lt; &quot;bake mutton \n&quot;;}
    void bake_chicken() {cout &lt;&lt; &quot;bake chicken\n&quot;;}
};

class MuttonCommand : public Command {
    public:
    MuttonCommand(Barbecue* barbecue) : barbecue_(barbecue) {}

    void execute() {
        this-&gt;barbecue_-&gt;bake_mutton();
    }
    private:
    Barbecue* barbecue_ = nullptr;
};

class ChickenCommand : public Command {
    public:
    ChickenCommand(Barbecue* barbecue) : barbecue_(barbecue) {}

    void execute() {
        this-&gt;barbecue_-&gt;bake_chicken();
    }
    private:
    Barbecue* barbecue_ = nullptr;
};

class Waiter {
    public:
    Waiter() {}

    void AddOrder(Command* cmd) {
        this-&gt;orders.push_back(cmd);
    }

    void DelOrder(Command* cmd) {
        this-&gt;orders.remove(cmd);
    }

    void Notify() {
        for (auto it : this-&gt;orders) {
            it-&gt;execute();
        }
    }
    private:
    list&lt;Command*&gt; orders;
};

int main() {
    auto boy = new Barbecue();
    Command* cmd1 = new MuttonCommand(boy);
    Command* cmd2 = new MuttonCommand(boy);
    Command* cmd3 = new ChickenCommand(boy);
    auto waiter = new Waiter();
    waiter-&gt;AddOrder(cmd1);
    waiter-&gt;AddOrder(cmd2);
    waiter-&gt;AddOrder(cmd3);
    waiter-&gt;Notify();
}
</code></pre>

<h4>golang_demo</h4>

<pre class="line-numbers"><code class="language-go">package desian_pattern_practise


import &quot;fmt&quot;

type Command interface {
    ExecuteCommand()
}

type Barbecue struct {}

func (b *Barbecue) BakeMutton() {
    fmt.Println(&quot;BakeMutton&quot;)
}

func (b *Barbecue) BakeChicken() {
    fmt.Println(&quot;BakeChicken&quot;)
}

type MuttonCommand struct {
    *Barbecue
}

func NewMuttonCommand(boy *Barbecue) *MuttonCommand {
    return &amp;MuttonCommand{
        Barbecue: boy,
    }
}

func (m *MuttonCommand) ExecuteCommand() {
    m.Barbecue.BakeMutton()
}

type BakeCommand struct {
    *Barbecue
}

func NewBakeCommand(boy *Barbecue) *BakeCommand {
    return &amp;BakeCommand{
        Barbecue: boy,
    }
}

func (b *BakeCommand) ExecuteCommand() {
    b.Barbecue.BakeChicken()
}

type Waiter struct {
    orders map[Command]bool
}

func NewWaiter() *Waiter {
    return &amp;Waiter{
        orders: make(map[Command]bool),
    }
}

func (w *Waiter) AddOrder(cmd Command) {
    w.orders[cmd] = true
}

func (w *Waiter) CancelOrder(cmd Command) {
    delete(w.orders, cmd)
}

func (w *Waiter) Notify() {
    for k, _ := range w.orders {
        k.ExecuteCommand()
    }
}
func TestBakeCommand_ExecuteCommand(t *testing.T) {
    boy := &amp;Barbecue{}

    cmd1, cmd2  := NewMuttonCommand(boy), NewMuttonCommand(boy)
    cmd3 := NewBakeCommand(boy)

    waiter := NewWaiter()
    waiter.AddOrder(cmd1)

    waiter.AddOrder(cmd2)

    waiter.AddOrder(cmd3)

    waiter.CancelOrder(cmd1)
    waiter.Notify()
}
</code></pre>

<h4>python_demo</h4>

<pre class="line-numbers"><code class="language-python">from abc import ABCMeta, abstractmethod

class Command(metaclass=ABCMeta):

    @abstractmethod
    def execute_command(self):
        pass

class Barbecue(object):

    def bake_mutton(self):
        print(&quot;bake mutton&quot;)

    def bake_chicken(self):
        print(&quot;bake chicken&quot;)

class MuttonCommand(Command):

    def __init__(self, barbecue):
        self.barbecue = barbecue

    def execute_command(self):
        self.barbecue.bake_mutton()


class ChickenCommand(Command):

    def __init__(self, barbecue):
        self.barbecue = barbecue

    def execute_command(self):
        self.barbecue.bake_chicken()

class Waiter(object):

    def __init__(self):
        self.__orders = []

    def add_order(self, cmd):
        self.__orders.append(cmd)

    def cancel_order(self, cmd):
        self.__orders.remove(cmd)

    def notify(self):
        for order in self.__orders:
            order.execute_command()

if __name__ == &#39;__main__&#39;:
    boy = Barbecue()

    cmd1 = MuttonCommand(boy)
    cmd2 = MuttonCommand(boy)
    cmd3 = ChickenCommand(boy)

    waiter = Waiter()

    waiter.add_order(cmd1)
    waiter.add_order(cmd2)
    waiter.add_order(cmd3)

    waiter.notify()
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2019/12/29 11:41 上午</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html'>设计模式</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
			<div class="article">
                <a class="clearlink" href="15768853718636.html">
                
                  <h1>Chain of Responsibility</h1>
                  <div class="a-content">
                      
                      <div class="a-content-text">
                        
                        	<h4>模式定义</h4>

<ul>
<li>使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系。将这些对象连成一条链，并沿着这条链传递请求，直到有一个对象处理它为止</li>
</ul>

<h4>结构</h4>

<ul>
<li><img src="media/15768853718636/15806441423658.jpg" alt="" style="width:799px;"/></li>
</ul>

<h4>要点总结</h4>

<ul>
<li>Chain of Responsibility 7 模式的应用场合在于“一个请求可能有多个接受者，但是最后真正的接受者只有一个“，这时候请求发送者与接受者的耦合有可能出现“变化脆弱”的症状，职责链的目的就是将二者解耦，从而更好地应对变化</li>
<li>应用了 Chain of Responsibility 模式后，对象的职责分派将更具灵活性。我们可以在运行时动态添加/修改请求的处理职责。</li>
<li>如果请求传递到职责链的末尾仍得不到处理，应该有一个合理的缺省机制。这也是每一个接受对象的责任，而不是发出请求的对象的责任。</li>
<li>这里发出这个请求的客户端并不知道这当中的哪一个对象最终处理这个请求，这样系统的更改可以在不影响客户端的情况下动态地重新组织和分配责任</li>
</ul>

<h4>cpp_demo</h4>

<pre class="line-numbers"><code class="language-cpp">//
// Created by eredinliu on 2020-02-03.
//

#include &lt;iostream&gt;
#include &lt;typeinfo&gt;
using namespace std;

class Request {
public:
    Request(const string&amp; name, const string&amp; reason, int day_off) :
            name_(name), reason_(reason), day_off_(day_off) {}
    string name_, reason_;
    int day_off_;
};

class Responsible {
public:
    void SetSuperior(Responsible* superior) {this-&gt;superior_ = superior;}
    Responsible() {}

    bool SuperiorHandle(Request* request) {
        if (this-&gt;superior_ != nullptr) {
            return this-&gt;superior_-&gt;HandleRequest(request);
        }

        cout &lt;&lt; &quot;Out of power, reject \n&quot;;
        return false;
    }

    virtual bool HandleRequest(Request* request) = 0;

private:
    Responsible* superior_;
};

class Supervisor : public  Responsible {
public:
    bool HandleRequest(Request* request) {
        if (request-&gt;day_off_ &gt; 0 &amp;&amp; request-&gt;day_off_ &lt;= 2) {
            cout &lt;&lt; typeid(this).name() &lt;&lt; &quot; permit \n&quot;;
            return true;
        }

        return this-&gt;SuperiorHandle(request);
    }
};

class Depmanager : public  Responsible {
public:
    bool HandleRequest(Request* request) {
        if (request-&gt;day_off_ &gt; 2 &amp;&amp; request-&gt;day_off_ &lt;= 5) {
            cout &lt;&lt; typeid(this).name() &lt;&lt; &quot; permit \n&quot;;
            return true;
        }

        return this-&gt;SuperiorHandle(request);
    }
};

class CEO : public  Responsible {
public:
    bool HandleRequest(Request* request) {
        if (request-&gt;day_off_ &gt; 5 &amp;&amp; request-&gt;day_off_ &lt;= 12) {
            cout &lt;&lt; typeid(this).name() &lt;&lt; &quot; permit \n&quot;;
            return true;
        }

        return this-&gt;SuperiorHandle(request);
    }
};

int main() {
    Responsible* ceo = new CEO();
    Responsible* dep = new Depmanager();
    Responsible* super = new Supervisor();
    dep-&gt;SetSuperior(ceo);
    super-&gt;SetSuperior(dep);

    Request* req = new Request(&quot;ming&quot;, &quot;sick&quot;, 10);
    super-&gt;HandleRequest(req);
}
</code></pre>

<h4>golang_demo</h4>

<pre class="line-numbers"><code class="language-go">package design_pattern

import (
    &quot;fmt&quot;
    &quot;reflect&quot;
)

type Request struct {
    name, reason string
    dayOff int
}

type Responsible interface {
    HandlerRequest(*Request) bool
}

type Manager struct {
    superior Responsible
}

func (m *Manager) HandlerRequest(*Request) bool {
    return true
}

func (m *Manager) SetSuperior(superior Responsible) {
    m.superior = superior
}

func (m *Manager) SuperHandle(r *Request) bool {
    if m.superior != nil {
      return m.superior.HandlerRequest(r)
    }

    fmt.Println(&quot;out of power, reject&quot;)
    return false
}

type Supervisor struct {
    *Manager
}

func (s *Supervisor) HandlerRequest(r *Request) bool {
    
    if r.dayOff &gt; 0 &amp;&amp; r.dayOff &lt;=2 {
        fmt.Println(reflect.TypeOf(s).String() + &quot; Permit&quot;)
        return true
    }

    return s.SuperHandle(r)
}

func NewSupervisor() *Supervisor {
    return &amp;Supervisor{
        Manager: &amp;Manager{},
    }
}

type DepManager struct {
    *Manager
}

func (s *DepManager) HandlerRequest(r *Request) bool {

    if r.dayOff &gt; 2 &amp;&amp; r.dayOff &lt;=5 {
        fmt.Println(reflect.TypeOf(s).String() + &quot; Permit&quot;)
        return true
    }

    return s.SuperHandle(r)
}

func NewDepManager() *DepManager {
    return &amp;DepManager{
        Manager: &amp;Manager{},
    }
}

type CEO struct {
    *Manager
}

func (s *CEO) HandlerRequest(r *Request) bool {

    if r.dayOff &gt; 5 &amp;&amp; r.dayOff &lt;=22 {
        fmt.Println(reflect.TypeOf(s).String() + &quot; Permit&quot;)
        return true
    }

    return s.SuperHandle(r)
}

func NewCEO() *CEO{
    return &amp;CEO{
        Manager: &amp;Manager{},
    }
}

func TestRequestChain(t *testing.T) {
    c1 := NewCEO()
    c1.SetSuperior(nil)
    c2 := NewDepManager()
    c2.SetSuperior(c1)
    c3 := NewSupervisor()
    c3.SetSuperior(c2)

    request := &amp;Request{
        name: &quot;ming&quot;,
        reason: &quot;sick&quot;,
        dayOff: 23,
    }

    c3.HandlerRequest(request)
}
</code></pre>

<h4>python_code</h4>

<pre class="line-numbers"><code class="language-python">from abc import ABCMeta, abstractmethod

class Request(object):

    def __init__(self, name, reason, dayOff):
        self.name, self.reason, self.dayOff = name, reason, dayOff

class Responsible(metaclass=ABCMeta):

    @abstractmethod
    def HandleRequest(self, request):
        pass

    def __init__(self):
        self.__superior = None

    def set_superior(self, superior):
        self.__superior = superior

    def super_handler(self, request):
        if not self.__superior is None:
            return self.__superior.HandleRequest(request)

        print(&quot;out of power, reject&quot;)
        return False


class Supervisor(Responsible):

    def HandleRequest(self, request):
        if request.dayOff &gt; 0 and request.dayOff &lt;= 2:
           print(type(self).__name__ + &#39; permit&#39;)
           return True

        return self.super_handler(request)


class DepManager(Responsible):

    def HandleRequest(self, request):
        if request.dayOff &gt; 2 and request.dayOff &lt;= 5:
            print(type(self).__name__ + &#39; permit&#39;)
            return True

        return self.super_handler(request)

class CEO(Responsible):

    def HandleRequest(self, request):
        if request.dayOff &gt; 2 and request.dayOff &lt;= 5:
            print(type(self).__name__ + &#39; permit&#39;)
            return True

        return self.super_handler(request)


if __name__ == &#39;__main__&#39;:
    c1 = CEO()
    c2 = DepManager()
    c2.set_superior(c1)
    c3 = Supervisor()
    c3.set_superior(c2)

    req = Request(&quot;ming&quot;, &quot;sick&quot;, 2)
    c3.HandleRequest(req)
</code></pre>

                        
                      </div>
                  </div>
                </a>
                <div class="read-more clearfix">
                  <div class="more-left left">
                  
                    <span class="date">2019/12/21 07:42 上午</span>
                    <span>posted in&nbsp;</span> 
          				  
          					    <span class="posted-in"><a href='%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html'>设计模式</a></span>
          				   
                  </div>
                  <div class="more-right right">
                  <span class="comments">
                      

                       
                  </span>
                  </div>
                </div>
              </div><!-- article -->
        
              


			<div class="row">
			  <div class="large-6 columns">
			  <p class="text-left" style="padding-top:25px;">
			   <a href="all.html">&laquo; Prev Page</a>  
			  </p>
			  </div>
			  <div class="large-6 columns">
			<p class="text-right" style="padding-top:25px;">
			 <a href="all_2.html">&raquo; Next Page</a> 
			</p>
			  </div>
			</div>
		</div>
	</div><!-- large 8 -->

 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <h1>eredin-blog</h1>
                <div class="site-des">生命的意义是成为你自己！</div>
                <div class="social">











  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="Prometheus.html"><strong>Prometheus</strong></a>
        
            <a href="RocketMQ.html"><strong>RocketMQ</strong></a>
        
            <a href="%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE.html"><strong>网络协议</strong></a>
        
            <a href="Golang.html"><strong>Golang</strong></a>
        
            <a href="Django.html"><strong>Django</strong></a>
        
            <a href="%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90Kubernetes.html"><strong>深入剖析Kubernetes</strong></a>
        
            <a href="%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95.html"><strong>数据结构和算法</strong></a>
        
            <a href="%E5%BE%AE%E6%9C%8D%E5%8A%A1.html"><strong>微服务</strong></a>
        
            <a href="%E6%9E%B6%E6%9E%84.html"><strong>架构</strong></a>
        
            <a href="%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86.html"><strong>操作系统原理</strong></a>
        
            <a href="Mysql%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98.html"><strong>Mysql优化实战</strong></a>
        
            <a href="Kafka.html"><strong>Kafka</strong></a>
        
            <a href="linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%A0%94%E5%8F%91.html"><strong>linux服务器研发</strong></a>
        
            <a href="%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86.html"><strong>计算机组成原理</strong></a>
        
            <a href="%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%84%E8%87%AA%E6%88%91%E4%BF%AE%E5%85%BB.html"><strong>程序员的自我修养</strong></a>
        
            <a href="C%E8%AF%AD%E8%A8%80%E8%BF%9B%E9%98%B6.html"><strong>C语言进阶</strong></a>
        
            <a href="http_study.html"><strong>http_study</strong></a>
        
            <a href="%E7%8E%A9%E8%BD%AC%E7%AE%97%E6%B3%95.html"><strong>玩转算法</strong></a>
        
            <a href="C++%E5%AF%B9%E8%B1%A1%E6%A8%A1%E5%9E%8B.html"><strong>C++对象模型</strong></a>
        
            <a href="SQL%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A.html"><strong>SQL必知必会</strong></a>
        
            <a href="Zookeeper.html"><strong>Zookeeper</strong></a>
        
            <a href="Redis%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E7%B2%BE%E9%80%9A.html"><strong>Redis从入门到精通</strong></a>
        
            <a href="%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95%E8%BF%9B%E9%98%B6.html"><strong>数据结构和算法进阶</strong></a>
        
            <a href="Mysql%E6%80%A7%E8%83%BD%E7%AE%A1%E7%90%86%E5%92%8C%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1.html"><strong>Mysql性能管理和架构设计</strong></a>
        
            <a href="%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98.html"><strong>网络编程实战</strong></a>
        
            <a href="Redis%E9%AB%98%E5%B9%B6%E5%8F%91%E7%BC%93%E5%AD%98.html"><strong>Redis高并发缓存</strong></a>
        
            <a href="C++%E5%9F%BA%E7%A1%80%E4%B8%8E%E6%8F%90%E9%AB%98.html"><strong>C++基础与提高</strong></a>
        
            <a href="%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%BE%8E.html"><strong>设计模式之美</strong></a>
        
            <a href="Python.html"><strong>Python</strong></a>
        
            <a href="%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html"><strong>设计模式</strong></a>
        
            <a href="Linux%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E5%AE%9E%E6%88%98.html"><strong>Linux性能优化实战</strong></a>
        
            <a href="%E5%80%99%E6%8D%B7STL.html"><strong>候捷STL</strong></a>
        
            <a href="%E6%80%A7%E8%83%BD%E5%B7%A5%E7%A8%8B%E9%AB%98%E6%89%8B%E8%AF%BE.html"><strong>性能工程高手课</strong></a>
        
            <a href="%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95.html"><strong>性能测试</strong></a>
        
            <a href="ElasticSearch.html"><strong>ElasticSearch</strong></a>
        
            <a href="RabbitMQ.html"><strong>RabbitMQ</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="15818128782116.html">Singleton</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15748977610569.html">State</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15817697569868.html">字符串分割</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15817610843879.html">编译期</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15813101435484.html">列表&字典&集合进阶用法</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>


  </body>
</html>
